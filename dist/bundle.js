/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={0:(e,t,n)=>{n.d(t,{MF:()=>ue,j6:()=>ie,xZ:()=>oe,om:()=>se,Sx:()=>le,Wp:()=>he,KO:()=>de});var r=n(711),s=n(722),i=n(47);let o,a;const c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,d=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function p(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(g(this),e),m(c.get(this))}:function(...e){return m(t.apply(g(this),e))}:function(e,...n){const r=t.call(g(this),e,...n);return h.set(r,e.sort?e.sort():[e]),m(r)}:(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});u.set(e,t)}(e),n=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>n instanceof e)?new Proxy(e,f):e);var t,n}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(m(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&c.set(t,e)}).catch(()=>{}),d.set(t,e),t}(e);if(l.has(e))return l.get(e);const t=p(e);return t!==e&&(l.set(e,t),d.set(t,e)),t}const g=e=>d.get(e),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function _(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return w.set(t,i),i}var E;E=f,f={...E,get:(e,t,n)=>_(e,t)||E.get(e,t,n),has:(e,t)=>!!_(e,t)||E.has(e,t)};class I{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const b="@firebase/app",T="0.14.6",S=new s.Vy("@firebase/app"),C="@firebase/app-compat",k="@firebase/analytics-compat",A="@firebase/analytics",N="@firebase/app-check-compat",R="@firebase/app-check",D="@firebase/auth",P="@firebase/auth-compat",O="@firebase/database",L="@firebase/data-connect",M="@firebase/database-compat",x="@firebase/functions",V="@firebase/functions-compat",U="@firebase/installations",F="@firebase/installations-compat",B="@firebase/messaging",j="@firebase/messaging-compat",q="@firebase/performance",$="@firebase/performance-compat",z="@firebase/remote-config",H="@firebase/remote-config-compat",K="@firebase/storage",G="@firebase/storage-compat",W="@firebase/firestore",Q="@firebase/ai",J="@firebase/firestore-compat",X="firebase",Y="[DEFAULT]",Z={[b]:"fire-core",[C]:"fire-core-compat",[A]:"fire-analytics",[k]:"fire-analytics-compat",[R]:"fire-app-check",[N]:"fire-app-check-compat",[D]:"fire-auth",[P]:"fire-auth-compat",[O]:"fire-rtdb",[L]:"fire-data-connect",[M]:"fire-rtdb-compat",[x]:"fire-fn",[V]:"fire-fn-compat",[U]:"fire-iid",[F]:"fire-iid-compat",[B]:"fire-fcm",[j]:"fire-fcm-compat",[q]:"fire-perf",[$]:"fire-perf-compat",[z]:"fire-rc",[H]:"fire-rc-compat",[K]:"fire-gcs",[G]:"fire-gcs-compat",[W]:"fire-fst",[J]:"fire-fst-compat",[Q]:"fire-vertex","fire-js":"fire-js",[X]:"fire-js-all"},ee=new Map,te=new Map,ne=new Map;function re(e,t){try{e.container.addComponent(t)}catch(n){S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function se(e){const t=e.name;if(ne.has(t))return S.debug(`There were multiple attempts to register component ${t}.`),!1;ne.set(t,e);for(const t of ee.values())re(t,e);for(const t of te.values())re(t,e);return!0}function ie(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function oe(e){return null!=e&&void 0!==e.settings}const ae=new i.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ce{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ae.create("app-deleted",{appName:this._name})}}const ue="12.6.0";function he(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s={name:Y,automaticDataCollectionEnabled:!0,...t},o=s.name;if("string"!=typeof o||!o)throw ae.create("bad-app-name",{appName:String(o)});if(n||(n=(0,i.T9)()),!n)throw ae.create("no-options");const a=ee.get(o);if(a){if((0,i.bD)(n,a.options)&&(0,i.bD)(s,a.config))return a;throw ae.create("duplicate-app",{appName:o})}const c=new r.h1(o);for(const e of ne.values())c.addComponent(e);const u=new ce(n,s,c);return ee.set(o,u),u}function le(e=Y){const t=ee.get(e);if(!t&&e===Y&&(0,i.T9)())return he();if(!t)throw ae.create("no-app",{appName:e});return t}function de(e,t,n){let s=Z[e]??e;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void S.warn(e.join(" "))}se(new r.uA(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const fe="firebase-heartbeat-store";let pe=null;function me(){return pe||(pe=function(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=m(o);return r&&o.addEventListener("upgradeneeded",e=>{r(m(o.result),e.oldVersion,e.newVersion,m(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(fe)}catch(e){console.warn(e)}}}).catch(e=>{throw ae.create("idb-open",{originalErrorMessage:e.message})})),pe}async function ge(e,t){try{const n=(await me()).transaction(fe,"readwrite"),r=n.objectStore(fe);await r.put(t,ye(e)),await n.done}catch(e){if(e instanceof i.g)S.warn(e.message);else{const t=ae.create("idb-set",{originalErrorMessage:e?.message});S.warn(t.message)}}}function ye(e){return`${e.name}!${e.options.appId}`}class ve{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _e(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=we();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){S.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=we(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),Ee(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ee(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,i.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return S.warn(e),""}}}function we(){return(new Date).toISOString().substring(0,10)}class _e{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.zW)()&&(0,i.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await me()).transaction(fe),n=await t.objectStore(fe).get(ye(e));return await t.done,n}catch(e){if(e instanceof i.g)S.warn(e.message);else{const t=ae.create("idb-get",{originalErrorMessage:e?.message});S.warn(t.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ge(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ge(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Ee(e){return(0,i.Uj)(JSON.stringify({version:2,heartbeats:e})).length}se(new r.uA("platform-logger",e=>new I(e),"PRIVATE")),se(new r.uA("heartbeat",e=>new ve(e),"PRIVATE")),de(b,T,""),de(b,T,"esm2020"),de("fire-js","")},47:(e,t,n)=>{n.d(t,{cY:()=>p,FA:()=>O,g:()=>P,u:()=>a,Uj:()=>o,Fy:()=>y,tD:()=>j,bD:()=>x,hp:()=>B,T9:()=>d,Tj:()=>h,yU:()=>l,XA:()=>f,mS:()=>c,Ku:()=>z,ZQ:()=>E,sr:()=>S,zJ:()=>m,c1:()=>T,Im:()=>M,lT:()=>k,zW:()=>R,jZ:()=>I,lV:()=>C,nr:()=>A,Ov:()=>N,gE:()=>g,Am:()=>U,I9:()=>F,P1:()=>_,eX:()=>D});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=r(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}const u=()=>{try{return c().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},h=e=>u()?.emulatorHosts?.[e],l=e=>{const t=h(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},d=()=>u()?.config,f=e=>u()?.[`_${e}`];class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function m(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function g(e){return(await fetch(e,{credentials:"include"})).ok}function y(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(i)),""].join(".")}const v={};let w=!1;function _(e,t){if("undefined"==typeof window||"undefined"==typeof document||!m(window.location.host)||v[e]===t||v[e]||w)return;function n(e){return`__firebase__banner__${e}`}v[e]=t;const r="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(v))v[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),i=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{w=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,i,a,n),document.body.appendChild(t)}s?(i.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function E(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(E())}function b(){const e=u()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function T(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function S(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function C(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function k(){const e=E();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function A(){return!b()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function N(){return!b()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function R(){try{return"object"==typeof indexedDB}catch(e){return!1}}function D(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}class P extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,P.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,O.prototype.create)}}class O{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(L,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new P(r,o,n)}}const L=/\{\$([^}]+)}/g;function M(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function x(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(V(n)&&V(i)){if(!x(n,i))return!1}else if(n!==i)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function V(e){return null!==e&&"object"==typeof e}function U(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function F(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function B(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function j(e,t){const n=new q(e,t);return n.subscribe.bind(n)}class q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=$),void 0===r.error&&(r.error=$),void 0===r.complete&&(r.complete=$);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $(){}function z(e){return e&&e._delegate?e._delegate:e}},70:(e,t,n)=>{n.d(t,{b:()=>c,initHistoryDropdown:()=>g,initSearchAddon:()=>d});var r=n(779),s=n(726),i=n(589),o=n(876),a=n(887);function c(){document.getElementById("public-decks");const e=document.getElementById("user-decks");e&&(0,s.hg)(r.j,t=>{if(!t)return;const n=(0,i.P)((0,i.rJ)(r.db,"decks"),(0,i._M)("ownerId","==",t.uid),(0,i.My)("createdAt","desc"));(0,i.aQ)(n,t=>{e.querySelectorAll(".deck-card:not(#create-deck-btn)").forEach(e=>e.remove()),t.forEach(t=>{l.find(e=>e.id===t.id)||l.push({id:t.id,...t.data()}),h(t,e)})})}),(()=>{const e=document.getElementById("sort-select").value,t=(0,i.P)((0,i.rJ)(r.db,"decks"),(0,i._M)("isPublic","==",!0),(0,i.My)("createdAt","desc"));(0,i.aQ)(t,t=>{l=[],t.forEach(e=>{l.push({id:e.id,...e.data()})}),u(l,e)})})(),document.getElementById("sort-select").addEventListener("change",e=>{u(l,e.target.value)})}function u(e,t){const n=document.getElementById("public-decks");n.innerHTML="";let r=[...e];"popular"===t?r.sort((e,t)=>{const n=e.likes?Object.keys(e.likes).length:0;return(t.likes?Object.keys(t.likes).length:0)-n}):r.sort((e,t)=>t.createdAt-e.createdAt),r.forEach(e=>{h({id:e.id,data:()=>e},n)});const s=document.getElementById("create-deck-btn");s&&s.addEventListener("click",()=>{document.dispatchEvent(new Event("create-deck"))})}function h(e,t){const n=e.data(),s=r.j.currentUser,c=n.likes?Object.keys(n.likes).length:0,u=s&&n.likes?.[s.uid],h=s&&n.ownerId===s.uid,l=document.createElement("div");if(l.className="deck-card",l.innerHTML=`\n    ${h?'\n      <div class="deck-menu">\n        <button class="menu-btn">‚ãÆ</button>\n        <div class="menu-dropdown">\n          <button class="edit-deck">Edit deck</button>\n          <button class="delete-deck danger">Delete deck</button>\n        </div>\n      </div>\n    ':""}\n\n    <button class="bookmark">üîñ</button>\n    <h4>${n.title}</h4>\n    <p>${n.description}</p>\n    ${n.tags&&n.tags.length?`\n    <div class="deck-tags" style="display: flex; gap: 4px; flex-wrap: wrap; margin-top: 8px;">\n      ${n.tags.map(e=>`<span style="background: #eef2ff; color: #2563eb; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem;">#${e}</span>`).join("")}\n    </div>`:""}\n\n    <div class="deck-actions">\n      <span class="like-btn">${u?"‚ù§Ô∏è":"‚ô°"}</span>\n      <span class="like-count">${c}</span>\n    </div>\n  `,h){const t=l.querySelector(".menu-btn"),s=l.querySelector(".menu-dropdown");t.onclick=e=>{e.stopPropagation(),s.style.display="block"===s.style.display?"none":"block"},document.addEventListener("click",()=>{s.style.display="none"},{once:!0}),l.querySelector(".edit-deck").onclick=t=>{t.stopPropagation();const s=document.getElementById("edit-deck-modal"),o=document.getElementById("edit-deck-title"),a=document.getElementById("edit-deck-description"),c=document.getElementById("edit-deck-tags"),u=document.getElementById("save-deck-changes"),h=document.getElementById("cancel-deck-edit");o.value=n.title,a.value=n.description||"",c.value=n.tags?n.tags.join(", "):"",s.classList.remove("hidden"),u.onclick=async()=>{const t=o.value.trim(),n=a.value.trim(),u=c.value.trim();let h=[];if(u.length>0&&(h=u.split(",").map(e=>e.trim()).filter(e=>e.length>0)),t)try{await(0,i.mZ)((0,i.H9)(r.db,"decks",e.id),{title:t,description:n,tags:h}),s.classList.add("hidden")}catch(e){alert("Failed to update deck"),console.error(e)}else alert("Deck title cannot be empty")},h.onclick=()=>{s.classList.add("hidden")}},l.querySelector(".delete-deck").onclick=async t=>{if(t.stopPropagation(),confirm("Are you sure?\nThis will permanently delete the deck."))try{await(0,i.kd)((0,i.H9)(r.db,"decks",e.id))}catch(e){alert("Failed to delete deck"),console.error(e)}}}l.querySelector(".like-btn").onclick=async t=>{if(t.stopPropagation(),!s)return;const o=(0,i.H9)(r.db,"decks",e.id);n.likes?.[s.uid]?await(0,i.mZ)(o,{[`likes.${s.uid}`]:(0,i.CL)()}):await(0,i.mZ)(o,{[`likes.${s.uid}`]:!0})},l.querySelector(".bookmark").onclick=t=>{t.stopPropagation(),s&&(0,i.BN)((0,i.H9)(r.db,"users",s.uid,"savedDecks",e.id),{savedAt:(0,i.O5)()})},l.onclick=t=>{t.target.closest(".like-btn")||t.target.closest(".bookmark")||t.target.closest(".menu-btn")||t.target.closest(".menu-dropdown")||((0,o.Q0)(),setTimeout(async()=>{await(0,a.YX)(e.id,h),p(e.id),m(e.id,n),h&&(document.getElementById("add-card-btn").onclick=()=>{(0,a.pL)(e.id)})},50))},t.appendChild(l)}document.addEventListener("create-deck",()=>{const e=document.getElementById("create-deck-modal"),t=document.getElementById("create-deck-title"),n=document.getElementById("create-deck-description"),s=document.getElementById("create-deck-confirm"),o=document.getElementById("create-deck-cancel");t.value="",n.value="",document.getElementById("create-deck-tags").value="",e.classList.remove("hidden"),s.onclick=async()=>{const s=t.value.trim(),o=n.value.trim(),a=document.getElementById("create-deck-tags").value.trim();let c=[];if(a.length>0&&(c=a.split(",").map(function(e){return e.trim()}).filter(function(e){return e.length>0})),s)try{await(0,i.gS)((0,i.rJ)(r.db,"decks"),{title:s,description:o,tags:c,ownerId:r.j.currentUser.uid,isPublic:!1,likes:{},createdAt:(0,i.O5)()}),e.classList.add("hidden")}catch(e){alert("Failed to create deck"),console.error(e)}else alert("Deck title is required")},o.onclick=()=>{e.classList.add("hidden")}});let l=[];function d(){const e=document.getElementById("search-input"),t=document.getElementById("search-overlay"),n=document.getElementById("search-results"),s=document.querySelector("main");e&&t&&n&&s&&(e.addEventListener("input",()=>{const i=e.value.trim().toLowerCase();if(!i)return t.classList.add("hidden"),s.classList.remove("dimmed"),void(n.innerHTML="");const c=l.filter(e=>{const t=e.title&&e.title.toLowerCase().includes(i),n=e.description&&e.description.toLowerCase().includes(i);let r=!1;return e.tags&&(r=e.tags.some(e=>e.toLowerCase().includes(i))),t||n||r});n.innerHTML="",c.forEach(e=>{!function(e,t){const n=document.createElement("div");n.className="deck-card",n.innerHTML=`\n    <h4>${e.title}</h4>\n    <p>${e.description||""}</p>\n    <div class="deck-actions">\n      <span>‚ù§Ô∏è ${Object.keys(e.likes||{}).length}</span>\n    </div>\n  `,n.onclick=()=>{document.getElementById("search-overlay").classList.add("hidden"),document.getElementById("app-section").classList.remove("dimmed"),(0,o.Q0)(),(0,a.YX)(e.id,!1);const t=r.j.currentUser&&r.j.currentUser.uid===e.ownerId;(0,a.YX)(e.id,t),p(e.id),m(e.id,e);const n=document.getElementById("add-card-btn");n&&(n.style.display="none")},t.appendChild(n)}(e,n)}),t.classList.remove("hidden"),s.classList.add("dimmed")}),document.addEventListener("click",n=>{if(n.target===e)return;const r=n.target.closest(".deck-card"),i=t.contains(n.target);(!i||i&&!r)&&(t.classList.add("hidden"),s.classList.remove("dimmed"))}))}document.addEventListener("DOMContentLoaded",d);let f=null;function p(e){const t=document.getElementById("comments-list"),n=document.getElementById("comment-text"),s=document.getElementById("post-comment-btn");if(!t||!n||!s)return;const o=r.j.currentUser;if(!o)return;const a=(0,i.rJ)(r.db,"decks",e,"comments");f&&f(),f=(0,i.aQ)(a,s=>{t.innerHTML="",s.forEach(s=>{const a=s.data(),c=s.id===o.uid,u=document.createElement("div");if(u.className="comment-card",u.innerHTML=`\n        <div class="comment-header">\n          <strong>${a.username}</strong>\n          ${c?'\n            <div class="comment-menu">\n              <button class="menu-btn">‚ãÆ</button>\n              <div class="menu-dropdown">\n                <button class="edit-comment">Edit</button>\n                <button class="delete-comment danger">Delete</button>\n              </div>\n            </div>\n          ':""}\n        </div>\n        <p class="comment-text">${a.text}</p>\n      `,c){const e=u.querySelector(".menu-btn"),t=u.querySelector(".menu-dropdown");e.onclick=e=>{e.stopPropagation(),t.style.display="block"===t.style.display?"none":"block"},document.addEventListener("click",()=>{t.style.display="none"})}c&&(u.querySelector(".edit-comment").onclick=()=>{n.value=a.text},u.querySelector(".delete-comment").onclick=async()=>{confirm("Delete your comment?")&&await(0,i.kd)((0,i.H9)(r.db,"decks",e,"comments",o.uid))}),t.appendChild(u)})}),s.onclick=async()=>{const t=n.value.trim();if(t)try{await(0,i.BN)((0,i.H9)(r.db,"decks",e,"comments",o.uid),{text:t,username:o.displayName||"User",createdAt:(0,i.O5)()}),n.value=""}catch(e){alert("Failed to post comment"),console.error(e)}}}async function m(e,t){const n=r.j.currentUser;if(n)try{const s=(0,i.H9)(r.db,"users",n.uid,"history",e);await(0,i.BN)(s,{title:t.title,description:t.description||"",lastVisited:(0,i.O5)(),deckId:e},{merge:!0})}catch(e){console.error("Error adding to history:",e)}}function g(){const e=document.getElementById("history-btn"),t=document.getElementById("history-dropdown");e&&t&&(e.onclick=async e=>{e.stopPropagation();const s="block"===t.style.display;if(t.style.display=s?"none":"block",!s){const e=r.j.currentUser;if(!e)return void(t.innerHTML="<p style='padding:12px; font-size:0.9rem'>Login to see history</p>");const s=(0,i.P)((0,i.rJ)(r.db,"users",e.uid,"history"),(0,i.My)("lastVisited","desc")),c=await(0,i.GG)(s);if(c.empty)return void(t.innerHTML="<p style='padding:12px; color:#666; font-size:0.9rem'>No history yet</p>");t.innerHTML="",c.forEach(e=>{const s=e.data(),c=document.createElement("button");c.style.textAlign="left",c.style.padding="8px 12px",c.style.borderBottom="1px solid #eee",c.style.width="100%",c.innerHTML=`<strong>${s.title}</strong>`,c.onclick=()=>{!async function(e){try{const t=await Promise.resolve().then(n.bind(n,779)).then(t=>(0,i.H9)(t.db,"decks",e)).then(e=>Promise.resolve().then(n.bind(n,589)).then(t=>t.getDoc(e)));if(t.exists()){const n=t.data(),s=r.j.currentUser&&r.j.currentUser.uid===n.ownerId;document.getElementById("deck-title").innerText=n.title,document.getElementById("deck-description").innerText=n.description,(0,o.Q0)(),(0,a.YX)(e,s),p(e),m(e,n)}}catch(e){console.error(e)}}(s.deckId)},t.appendChild(c)})}},document.addEventListener("click",()=>{t.style.display="none"}))}},589:(e,t,n)=>{n.d(t,{gS:()=>Ec,rJ:()=>pa,kd:()=>_c,CL:()=>Sc,H9:()=>ma,getDoc:()=>mc,GG:()=>yc,aU:()=>Ea,aQ:()=>Ic,My:()=>sc,P:()=>Za,O5:()=>Cc,BN:()=>vc,mZ:()=>wc,_M:()=>tc});var r,s,i=n(0),o=n(711),a=n(722),c=n(47),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},h={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const r=Array(16);if("string"==typeof t)for(var s=0;s<16;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let i,o=e.g[3];i=t+(o^n&(s^o))+r[0]+3614090360&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[1]+3905402710&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[2]+606105819&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[3]+3250441966&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[4]+4118548399&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[5]+1200080426&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[6]+2821735955&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[7]+4249261313&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[8]+1770035416&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[9]+2336552879&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[10]+4294925233&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[11]+2304563134&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[12]+1804603682&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[13]+4254626195&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[14]+2792965006&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[15]+1236535329&4294967295,i=t+(s^o&((n=s+(i<<22&4294967295|i>>>10))^s))+r[1]+4129170786&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[6]+3225465664&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[11]+643717713&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[0]+3921069994&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[5]+3593408605&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[10]+38016083&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[15]+3634488961&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[4]+3889429448&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[9]+568446438&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[14]+3275163606&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[3]+4107603335&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[8]+1163531501&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[13]+2850285829&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[2]+4243563512&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[7]+1735328473&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[12]+2368359562&4294967295,i=t+((n=s+(i<<20&4294967295|i>>>12))^s^o)+r[5]+4294588738&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[8]+2272392833&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[11]+1839030562&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[14]+4259657740&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[1]+2763975236&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[4]+1272893353&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[7]+4139469664&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[10]+3200236656&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[13]+681279174&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[0]+3936430074&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[3]+3572445317&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[6]+76029189&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[9]+3654602809&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[12]+3873151461&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[15]+530742520&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[2]+3299628645&4294967295,i=t+(s^((n=s+(i<<23&4294967295|i>>>9))|~o))+r[0]+4096336452&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[7]+1126891415&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[14]+2878612391&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[5]+4237533241&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[12]+1700485571&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[3]+2399980690&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[10]+4293915773&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[1]+2240044497&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[8]+1873313359&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[15]+4264355552&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[6]+2734768916&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[13]+1309151649&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[4]+4149444226&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[11]+3174756917&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[2]+718787259&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+o&4294967295}function i(e,t){this.h=t;const n=[];let r=!0;for(let s=e.length-1;s>=0;s--){const i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,s=this.C;let i=this.h,o=0;for(;o<t;){if(0==i)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var o={};function a(e){return-128<=e&&e<128?function(e){var t=o;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new i([0|e],e<0?-1:0)}(e)}(e):new i([0|e],e<0?-1:0)}function c(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return m(c(-e));const t=[];let n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new i(t,0)}var u=a(0),l=a(1),d=a(16777216);function f(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return-1==e.h}function m(e){const t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(l)}function g(e,t){return e.add(m(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function w(e,t){if(f(t))throw Error("division by zero");if(f(e))return new v(u,u);if(p(e))return t=w(m(e),t),new v(m(t.g),m(t.h));if(p(t))return t=w(e,m(t)),new v(m(t.g),t.h);if(e.g.length>30){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;r.l(e)<=0;)n=_(n),r=_(r);var s=E(n,1),i=E(r,1);for(r=E(r,2),n=E(n,2);!f(r);){var o=i.add(r);o.l(e)<=0&&(s=s.add(n),i=o),r=E(r,1),n=E(n,1)}return t=g(e,s.j(t)),new v(s,t)}for(s=u;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),o=(i=c(n)).j(t);p(o)||o.l(e)>0;)o=(i=c(n-=r)).j(t);f(i)&&(i=l),s=s.add(i),e=g(e,o)}return new v(s,e)}function _(e){const t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function E(e,t){const n=t>>5;t%=32;const r=e.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(s,e.h)}(e=i.prototype).m=function(){if(p(this))return-m(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(p(this))return"-"+m(this).toString(e);const t=c(Math.pow(e,6));var n=this;let r="";for(;;){const s=w(n,t).g;let i=(((n=g(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(f(n=s))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return p(e=g(this,e))?-1:f(e)?0:1},e.abs=function(){return p(this)?m(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let r=0;for(let s=0;s<=t;s++){let t=r+(65535&this.i(s))+(65535&e.i(s)),i=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=i>>>16,t&=65535,i&=65535,n[s]=i<<16|t}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(f(this)||f(e))return u;if(p(this))return p(e)?m(this).j(m(e)):m(m(this).j(e));if(p(e))return m(this.j(m(e)));if(this.l(d)<0&&e.l(d)<0)return c(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){const s=this.i(r)>>>16,i=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=i*a,y(n,2*r+2*t),n[2*r+2*t+1]+=s*a,y(n,2*r+2*t+1),n[2*r+2*t+1]+=i*o,y(n,2*r+2*t+1),n[2*r+2*t+2]+=s*o,y(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},e.B=function(e){return w(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,s=h.Md5=t,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=c,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=c(Math.pow(n,8));let s=u;for(let e=0;e<t.length;e+=8){var i=Math.min(8,t.length-e);const o=parseInt(t.substring(e,e+i),n);i<8?(i=c(Math.pow(n,i)),s=s.j(i).add(c(o))):(s=s.j(r),s=s.add(c(o)))}return s},r=h.Integer=i}).apply(void 0!==u?u:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var l,d,f,p,m,g,y,v,w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},_={};(function(){var e,t=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof w&&w];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(r=r(i=s[e=e[e.length-1]]))!=i&&null!=r&&t(s,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},i=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}var E="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function I(e){const t=e.length;if(t>0){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function b(e,t){for(let t=1;t<arguments.length;t++){const r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;const t=r.length||0;e.length=n+t;for(let s=0;s<t;s++)e[n+s]=r[s]}else e.push(r)}}function T(e){i.setTimeout(()=>{throw e},0)}function S(){var e=R;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var C=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,N=!1,R=new class{constructor(){this.h=this.g=null}add(e,t){const n=C.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},D=()=>{const e=Promise.resolve(void 0);A=()=>{e.then(P)}};function P(){for(var e;e=S();){try{e.h.call(e.g)}catch(e){T(e)}var t=C;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}N=!1}function O(){this.u=this.u,this.C=this.C}function L(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}O.prototype.u=!1,O.prototype.dispose=function(){this.u||(this.u=!0,this.N())},O.prototype[Symbol.dispose]=function(){this.dispose()},O.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},L.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function x(e){return/^[\s\xa0]*$/.test(e)}function V(e,t){L.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}h(V,L),V.prototype.init=function(e,t){const n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&V.Z.h.call(this)},V.prototype.h=function(){V.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),F=0;function B(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++F,this.da=this.fa=!1}function j(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function $(e){const t={};for(const n in e)t[n]=e[n];return t}const z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function H(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<z.length;t++)n=z[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function K(e){this.src=e,this.g={},this.h=0}function G(e,t){const n=t.type;if(n in e.g){var r,s=e.g[n],i=Array.prototype.indexOf.call(s,t,void 0);(r=i>=0)&&Array.prototype.splice.call(s,i,1),r&&(j(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function W(e,t,n,r){for(let s=0;s<e.length;++s){const i=e[s];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}K.prototype.add=function(e,t,n,r,s){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const o=W(e,t,r,s);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new B(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var Q="closure_lm_"+(1e6*Math.random()|0),J={};function X(e,t,n,r,s){if(r&&r.once)return Z(e,t,n,r,s);if(Array.isArray(t)){for(let i=0;i<t.length;i++)X(e,t[i],n,r,s);return null}return n=oe(n),e&&e[U]?e.J(t,n,o(r)?!!r.capture:!!r,s):Y(e,t,n,!1,r,s)}function Y(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=se(e);if(c||(e[Q]=c=new K(e)),(n=c.add(t,n,r,a,i)).proxy)return n;if(r=function(){const e=re;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)M||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(ne(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Z(e,t,n,r,s){if(Array.isArray(t)){for(let i=0;i<t.length;i++)Z(e,t[i],n,r,s);return null}return n=oe(n),e&&e[U]?e.K(t,n,o(r)?!!r.capture:!!r,s):Y(e,t,n,!0,r,s)}function ee(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)ee(e,t[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=oe(n),e&&e[U]?(e=e.i,(i=String(t).toString())in e.g&&(n=W(t=e.g[i],n,r,s))>-1&&(j(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--))):e&&(e=se(e))&&(t=e.g[t.toString()],e=-1,t&&(e=W(t,n,r,s)),(n=e>-1?t[e]:null)&&te(n))}function te(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])G(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ne(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=se(t))?(G(n,e),0==n.h&&(n.src=null,t[Q]=null)):j(e)}}}function ne(e){return e in J?J[e]:J[e]="on"+e}function re(e,t){if(e.da)e=!0;else{t=new V(t,this);const n=e.listener,r=e.ha||e.src;e.fa&&te(e),e=n.call(r,t)}return e}function se(e){return(e=e[Q])instanceof K?e:null}var ie="__closure_events_fn_"+(1e9*Math.random()>>>0);function oe(e){return"function"==typeof e?e:(e[ie]||(e[ie]=function(t){return e.handleEvent(t)}),e[ie])}function ae(){O.call(this),this.i=new K(this),this.M=this,this.G=null}function ce(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new L(t,e);else if(t instanceof L)t.target=t.target||e;else{var s=t;H(t=new L(r,e),s)}let i,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)i=t.g=n[o],s=ue(i,r,!0,t)&&s;if(i=t.g=e,s=ue(i,r,!0,t)&&s,s=ue(i,r,!1,t)&&s,n)for(o=0;o<n.length;o++)i=t.g=n[o],s=ue(i,r,!1,t)&&s}function ue(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let i=0;i<t.length;++i){const o=t[i];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&G(e.i,o),s=!1!==t.call(n,r)&&s}}return s&&!r.defaultPrevented}function he(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,he(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ae,O),ae.prototype[U]=!0,ae.prototype.removeEventListener=function(e,t,n,r){ee(this,e,t,n,r)},ae.prototype.N=function(){if(ae.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)j(n[e]);delete e.g[t],e.h--}}this.G=null},ae.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ae.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class le extends O{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:he(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function de(e){O.call(this),this.h=e,this.g={}}h(de,O);var fe=[];function pe(e){q(e.g,function(e,t){this.g.hasOwnProperty(t)&&te(e)},e),e.g={}}de.prototype.N=function(){de.Z.N.call(this),pe(this)},de.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var me=i.JSON.stringify,ge=i.JSON.parse,ye=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ve(){}function we(){}var _e={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ee(){L.call(this,"d")}function Ie(){L.call(this,"c")}h(Ee,L),h(Ie,L);var be={},Te=null;function Se(){return Te=Te||new ae}function Ce(e){L.call(this,be.Ia,e)}function ke(e){const t=Se();ce(t,new Ce(t))}function Ae(e,t){L.call(this,be.STAT_EVENT,e),this.stat=t}function Ne(e){const t=Se();ce(t,new Ae(t,e))}function Re(e,t){L.call(this,be.Ja,e),this.size=t}function De(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Pe(){this.g=!0}function Oe(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<r.length;e++)r[e]=""}}}return me(i)}catch(e){return t}}(e,n)+(r?" "+r:"")})}be.Ia="serverreachability",h(Ce,L),be.STAT_EVENT="statevent",h(Ae,L),be.Ja="timingevent",h(Re,L),Pe.prototype.ua=function(){this.g=!1},Pe.prototype.info=function(){};var Le,Me={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},xe={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ve(){}function Ue(e){return encodeURIComponent(String(e))}function Fe(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Be(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new de(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}h(Ve,ve),Ve.prototype.g=function(){return new XMLHttpRequest},Le=new Ve;var qe={},$e={};function ze(e,t,n){e.M=1,e.A=mt(ht(t)),e.u=n,e.R=!0,He(e,null)}function He(e,t){e.F=Date.now(),We(e),e.B=ht(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),Nt(n.i,"t",r),e.C=0,n=e.j.L,e.h=new je,e.g=gn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new le(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(fe[0]=s.toString()),s=fe);for(let e=0;e<s.length;e++){const i=X(n,s[e],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}t=e.J?$(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ke(),function(e,t,n,r,s,i){e.info(function(){if(e.g)if(i){var o="",a=i.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+c+"&":o+(e+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Ke(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Ge(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?$e:(n=Number(t.substring(n,r)),isNaN(n)?qe:(r+=1)+n>t.length?$e:(t=t.slice(r,r+n),e.C=r+n,t))}function We(e){e.T=Date.now()+e.H,Qe(e,e.H)}function Qe(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=De(c(e.aa,e),t)}function Je(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Xe(e){0==e.j.I||e.K||ln(e.j,e)}function Ye(e){Je(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,pe(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Ze(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||st(n.h,e)))if(!e.L&&st(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;hn(n),Zt(n)}an(n),Ne(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=De(c(n.Va,n),6e3));rt(n.h)<=1&&n.ta&&(n.ta=void 0)}else fn(n,11)}else if((e.L||n.g==e)&&hn(n),!x(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let c=s[t];const h=c[0];if(!(h<=n.K))if(n.K=h,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const h=c[5];null!=h&&"number"==typeof h&&h>0&&(r=1.5*h,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(it(i,i.h),i.h=null))}if(r.G){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,pt(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((r=n).na=mn(r,r.L?r.ba:null,r.W),o.L){ot(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(Je(a),We(a)),r.g=o}else on(r);n.i.length>0&&tn(n)}else"stop"!=c[0]&&"close"!=c[0]||fn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?fn(n,7):Yt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}ke()}catch(e){}}Be.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Wt(e)?t.j():this.Y(e)},Be.prototype.Y=function(e){try{if(e==this.g)e:{const c=Wt(this.g),u=this.g.ya();if(this.g.ca(),!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Qt(this.g)))){this.K||4!=c||7==u||ke(),Je(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Ke(e))return e.g.la();const t=Qt(e.g);if(""===t)return"";let n="";const r=t.length,s=4==Wt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Ye(e),Xe(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<r;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(s&&i==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,r,s,i,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,s=this.g;if((r=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(r)){var o=r;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,Ne(12),Ye(this),Xe(this);break e}Oe(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ze(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Ge(this,n),t==$e){4==c&&(this.m=4,Ne(14),e=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(t==qe){this.m=4,Ne(15),Oe(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Oe(this.i,this.l,t,null),Ze(this,t)}if(Ke(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,Ne(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),cn(a),a.P=!0,Ne(11))}}else Oe(this.i,this.l,n,"[Invalid Chunked Response]"),Ye(this),Xe(this)}else Oe(this.i,this.l,n,null),Ze(this,n);4==c&&Ye(this),this.o&&!this.K&&(4==c?ln(this.j,this):(this.o=!1,We(this)))}else(function(e){const t={};e=(e.g&&Wt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(x(e[r]))continue;var n=Fe(e[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),Ye(this),Xe(this)}}}catch(e){}},Be.prototype.cancel=function(){this.K=!0,Ye(this)},Be.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ke(),Ne(17)),Ye(this),this.m=2,Xe(this)):Qe(this,this.T-e)};var et=class{constructor(e,t){this.g=e,this.map=t}};function tt(e){this.l=e||10,e=i.PerformanceNavigationTiming?(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function nt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rt(e){return e.h?1:e.g?e.g.size:0}function st(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function it(e,t){e.g?e.g.add(t):e.h=t}function ot(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function at(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return I(e.i)}tt.prototype.cancel=function(){if(this.i=at(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ut(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof ut?(this.l=e.l,lt(this,e.j),this.o=e.o,this.g=e.g,dt(this,e.u),this.h=e.h,ft(this,Rt(e.i)),this.m=e.m):e&&(t=String(e).match(ct))?(this.l=!1,lt(this,t[1]||"",!0),this.o=gt(t[2]||""),this.g=gt(t[3]||"",!0),dt(this,t[4]),this.h=gt(t[5]||"",!0),ft(this,t[6]||"",!0),this.m=gt(t[7]||"")):(this.l=!1,this.i=new Tt(null,this.l))}function ht(e){return new ut(e)}function lt(e,t,n){e.j=n?gt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function dt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function ft(e,t,n){t instanceof Tt?(e.i=t,function(e,t){t&&!e.j&&(St(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(Ct(this,t),Nt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=yt(t,It)),e.i=new Tt(t,e.l))}function pt(e,t,n){e.i.set(t,n)}function mt(e){return pt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function gt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function yt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,vt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function vt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ut.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(yt(t,wt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(yt(t,wt,!0),"@"),e.push(Ue(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(yt(n,"/"==n.charAt(0)?Et:_t,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",yt(n,bt)),e.join("")},ut.prototype.resolve=function(e){const t=ht(this);let n=!!e.j;n?lt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)dt(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var s=t.h.lastIndexOf("/");-1!=s&&(r=t.h.slice(0,s+1)+r)}if(".."==(s=r)||"."==s)r="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){r=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?r&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==s.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=s}return n?t.h=r:n=""!==e.i.toString(),n?ft(t,Rt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var wt=/[#\/\?@]/g,_t=/[#\?:]/g,Et=/[#\?]/g,It=/[#\?@]/g,bt=/#/g;function Tt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function St(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const r=e[n].indexOf("=");let s,i=null;r>=0?(s=e[n].substring(0,r),i=e[n].substring(r+1)):s=e[n],t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Ct(e,t){St(e),t=Dt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function kt(e,t){return St(e),t=Dt(e,t),e.g.has(t)}function At(e,t){St(e);let n=[];if("string"==typeof t)kt(e,t)&&(n=n.concat(e.g.get(Dt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function Nt(e,t,n){Ct(e,t),n.length>0&&(e.i=null,e.g.set(Dt(e,t),I(n)),e.h+=n.length)}function Rt(e){const t=new Tt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function Dt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Pt(e,t,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(e){}}function Ot(){this.g=new ye}function Lt(e){this.i=e.Sb||null,this.h=e.ab||!1}function Mt(e,t){ae.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function xt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Vt(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Ut(e)}function Ut(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ft(e){let t="";return q(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Bt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Ft(n),"string"==typeof e?null!=n&&Ue(n):pt(e,t,n))}function jt(e){ae.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=Tt.prototype).add=function(e,t){St(this),this.i=null,e=Dt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){St(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.set=function(e,t){return St(this),this.i=null,kt(this,e=Dt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=At(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];const s=Ue(n);n=At(this,n);for(let t=0;t<n.length;t++){let r=s;""!==n[t]&&(r+="="+Ue(n[t])),e.push(r)}}return this.i=e.join("&")},h(Lt,ve),Lt.prototype.g=function(){return new Mt(this.i,this.h)},h(Mt,ae),(e=Mt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Ut(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Vt(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ut(this)),this.g&&(this.readyState=3,Ut(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;xt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Vt(this):Ut(this),3==this.readyState&&xt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Vt(this))},e.Na=function(e){this.g&&(this.response=e,Vt(this))},e.ga=function(){this.g&&Vt(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Mt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(jt,ae);var qt=/^https?$/i,$t=["POST","PUT"];function zt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Ht(e),Gt(e)}function Ht(e){e.A||(e.A=!0,ce(e,"complete"),ce(e,"error"))}function Kt(e){if(e.h&&void 0!==s)if(e.v&&4==Wt(e))setTimeout(e.Ca.bind(e),0);else if(ce(e,"readystatechange"),4==Wt(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){let t=String(e.D).match(ct)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),r=!qt.test(t?t.toLowerCase():"")}n=r}if(n)ce(e,"complete"),ce(e,"success");else{e.o=6;try{var o=Wt(e)>2?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.ca()+"]",Ht(e)}}finally{Gt(e)}}}function Gt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const n=e.g;e.g=null,t||ce(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function Wt(e){return e.g?e.g.readyState:0}function Qt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Jt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Xt(e){this.za=0,this.i=[],this.j=new Pe,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Jt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Jt("baseRetryDelayMs",5e3,e),this.Za=Jt("retryDelaySeedMs",1e4,e),this.Ta=Jt("forwardChannelMaxRetries",2,e),this.va=Jt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new tt(e&&e.concurrentRequestLimit),this.Ba=new Ot,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Yt(e){if(en(e),3==e.I){var t=e.V++,n=ht(e.J);if(pt(n,"SID",e.M),pt(n,"RID",t),pt(n,"TYPE","terminate"),rn(e,n),(t=new Be(e,e.j,t)).M=2,t.A=mt(ht(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=gn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),We(t)}pn(e)}function Zt(e){e.g&&(cn(e),e.g.cancel(),e.g=null)}function en(e){Zt(e),e.v&&(i.clearTimeout(e.v),e.v=null),hn(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function tn(e){if(!nt(e.h)&&!e.m){e.m=!0;var t=e.Ea;A||D(),N||(A(),N=!0),R.add(t,e),e.D=0}}function nn(e,t){var n;n=t?t.l:e.V++;const r=ht(e.J);pt(r,"SID",e.M),pt(r,"RID",n),pt(r,"AID",e.K),rn(e,r),e.u&&e.o&&Bt(r,e.u,e.o),n=new Be(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=sn(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),it(e.h,n),ze(n,r,t)}function rn(e,t){e.H&&q(e.H,function(e,n){pt(t,n,e)}),e.l&&q({},function(e,n){pt(t,n,e)})}function sn(e,t,n){n=Math.min(e.i.length,n);const r=e.l?c(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let u=0;u<n;u++){var i=s[u].g;const n=s[u].map;if((i-=t)<0)t=Math.max(0,s[u].g-100),c=!1;else try{i="req"+i+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let r=n;o(n)&&(r=me(n)),e.push(i+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function on(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;A||D(),N||(A(),N=!0),R.add(t,e),e.A=0}}function an(e){return!(e.g||e.v||e.A>=3||(e.Y++,e.v=De(c(e.Da,e),dn(e,e.A)),e.A++,0))}function cn(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function un(e){e.g=new Be(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=ht(e.na);pt(t,"RID","rpc"),pt(t,"SID",e.M),pt(t,"AID",e.K),pt(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&pt(t,"TO",e.ia),pt(t,"TYPE","xmlhttp"),rn(e,t),e.u&&e.o&&Bt(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=mt(ht(t)),n.u=null,n.R=!0,He(n,e)}function hn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function ln(e,t){var n=null;if(e.g==t){hn(e),cn(e),e.g=null;var r=2}else{if(!st(e.h,t))return;n=t.G,ot(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ce(r=Se(),new Re(r,n)),tn(e)}else on(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==r&&function(e,t){return!(rt(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=De(c(e.Ea,e,t),dn(e,e.D)),e.D++,0)))}(e,t)||2==r&&an(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:fn(e,5);break;case 4:fn(e,10);break;case 3:fn(e,6);break;default:fn(e,2)}}function dn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function fn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),r=e.Ua;const t=!r;r=new ut(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||lt(r,"https"),mt(r),t?function(e,t){const n=new Pe;if(i.Image){const r=new Image;r.onload=u(Pt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(Pt,n,"TestLoadImage: error",!1,t,r),r.onabort=u(Pt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(Pt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Pe;const n=new AbortController,r=setTimeout(()=>{n.abort(),Pt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Pt(0,0,!0,t):Pt(0,0,!1,t)}).catch(()=>{clearTimeout(r),Pt(0,0,!1,t)})}(r.toString(),n)}else Ne(2);e.I=0,e.l&&e.l.pa(t),pn(e),en(e)}function pn(e){if(e.I=0,e.ja=[],e.l){const t=at(e.h);0==t.length&&0==e.i.length||(b(e.ja,t),b(e.ja,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.oa()}}function mn(e,t,n){var r=n instanceof ut?ht(n):new ut(n);if(""!=r.g)t&&(r.g=t+"."+r.g),dt(r,r.u);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new ut(null);r&&lt(e,r),t&&(e.g=t),s&&dt(e,s),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&pt(r,n,t),pt(r,"VER",e.ka),rn(e,r),r}function gn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new jt(new Lt({ab:n})):new jt(e.ma)).Fa(e.L),t}function yn(){}function vn(){}function wn(e,t){ae.call(this),this.g=new Xt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!x(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!x(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new In(this)}function _n(e){Ee.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function En(){Ie.call(this),this.status=1}function In(e){this.g=e}(e=jt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Le.g(),this.g.onreadystatechange=E(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void zt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call($t,t,void 0)>=0)||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(e){zt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ce(this,"complete"),ce(this,"abort"),Gt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gt(this,!0)),jt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Kt(this):this.Xa())},e.Xa=function(){Kt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Wt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ge(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Xt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,r){Ne(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=mn(this,null,this.W),tn(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new Be(this,this.j,e);let i=this.o;if(this.U&&(i?(i=$(i),H(i,this.U)):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=sn(this,s,t),pt(n=ht(this.J),"RID",e),pt(n,"CVER",22),this.G&&pt(n,"X-HTTP-Session-Id",this.G),rn(this,n),i&&(this.R?t="headers="+Ue(Ft(i))+"&"+t:this.u&&Bt(n,this.u,i)),it(this.h,s),this.Ra&&pt(n,"TYPE","init"),this.S?(pt(n,"$req",t),pt(n,"SID","null"),s.U=!0,ze(s,n,null)):ze(s,n,t),this.I=2}}else 3==this.I&&(e?nn(this,e):0==this.i.length||nt(this.h)||nn(this))},e.Da=function(){if(this.v=null,un(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=De(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),Zt(this),un(this))},e.Va=function(){null!=this.C&&(this.C=null,Zt(this),an(this),Ne(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=yn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},vn.prototype.g=function(e,t){return new wn(e,t)},h(wn,ae),wn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},wn.prototype.close=function(){Yt(this.g)},wn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=me(e),e=n);t.i.push(new et(t.Ya++,e)),3==t.I&&tn(t)},wn.prototype.N=function(){this.g.l=null,delete this.j,Yt(this.g),delete this.g,wn.Z.N.call(this)},h(_n,Ee),h(En,Ie),h(In,yn),In.prototype.ra=function(){ce(this.g,"a")},In.prototype.qa=function(e){ce(this.g,new _n(e))},In.prototype.pa=function(e){ce(this.g,new En)},In.prototype.oa=function(){ce(this.g,"b")},vn.prototype.createWebChannel=vn.prototype.g,wn.prototype.send=wn.prototype.o,wn.prototype.open=wn.prototype.m,wn.prototype.close=wn.prototype.close,v=_.createWebChannelTransport=function(){return new vn},y=_.getStatEventTarget=function(){return Se()},g=_.Event=be,m=_.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Me.NO_ERROR=0,Me.TIMEOUT=8,Me.HTTP_ERROR=6,p=_.ErrorCode=Me,xe.COMPLETE="complete",f=_.EventType=xe,we.EventType=_e,_e.OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",ae.prototype.listen=ae.prototype.J,d=_.WebChannel=we,_.FetchXmlHttpFactory=Lt,jt.prototype.listenOnce=jt.prototype.K,jt.prototype.getLastError=jt.prototype.Ha,jt.prototype.getLastErrorCode=jt.prototype.ya,jt.prototype.getStatus=jt.prototype.ca,jt.prototype.getResponseJson=jt.prototype.La,jt.prototype.getResponseText=jt.prototype.la,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Fa,l=_.XhrIo=jt}).apply(void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const E="@firebase/firestore",I="4.9.2";class b{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}b.UNAUTHENTICATED=new b(null),b.GOOGLE_CREDENTIALS=new b("google-credentials-uid"),b.FIRST_PARTY=new b("first-party-uid"),b.MOCK_USER=new b("mock-user");let T="12.3.0";const S=new a.Vy("@firebase/firestore");function C(){return S.logLevel}function k(e,...t){if(S.logLevel<=a.$b.DEBUG){const n=t.map(R);S.debug(`Firestore (${T}): ${e}`,...n)}}function A(e,...t){if(S.logLevel<=a.$b.ERROR){const n=t.map(R);S.error(`Firestore (${T}): ${e}`,...n)}}function N(e,...t){if(S.logLevel<=a.$b.WARN){const n=t.map(R);S.warn(`Firestore (${T}): ${e}`,...n)}}function R(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function D(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,P(e,r,n)}function P(e,t,n){let r=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw A(r),new Error(r)}function O(e,t,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,e||P(t,s,r)}function L(e,t){return e}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends c.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class V{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class U{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class F{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(b.UNAUTHENTICATED))}shutdown(){}}class B{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class j{constructor(e){this.t=e,this.currentUser=b.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){O(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new V;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new V,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new V)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(O("string"==typeof t.accessToken,31837,{l:t}),new U(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return O(null===e||"string"==typeof e,2055,{h:e}),new b(e)}}class q{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=b.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ${constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new q(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(b.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class z{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class H{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,i.xZ)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){O(void 0===this.o,3512);const n=e=>{null!=e.error&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,k("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new z(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(O("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new z(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function K(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class G{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=K(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function W(e,t){return e<t?-1:e>t?1:0}function Q(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),s=t.charAt(r);if(n!==s)return Y(n)===Y(s)?W(n,s):Y(n)?1:-1}return W(e.length,t.length)}const J=55296,X=57343;function Y(e){const t=e.charCodeAt(0);return t>=J&&t<=X}function Z(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const ee="__name__";class te{constructor(e,t,n){void 0===t?t=0:t>e.length&&D(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&D(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===te.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof te?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=te.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return W(e.length,t.length)}static compareSegments(e,t){const n=te.isNumericId(e),r=te.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?te.extractNumericId(e).compare(te.extractNumericId(t)):Q(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class ne extends te{construct(e,t,n){return new ne(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new x(M.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new ne(t)}static emptyPath(){return new ne([])}}const re=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class se extends te{construct(e,t,n){return new se(e,t,n)}static isValidIdentifier(e){return re.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),se.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ee}static keyField(){return new se([ee])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new x(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new x(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new x(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new x(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new se(t)}static emptyPath(){return new se([])}}class ie{constructor(e){this.path=e}static fromPath(e){return new ie(ne.fromString(e))}static fromName(e){return new ie(ne.fromString(e).popFirst(5))}static empty(){return new ie(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ie(new ne(e.slice()))}}function oe(e,t,n){if(!n)throw new x(M.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ae(e){if(!ie.isDocumentKey(e))throw new x(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ce(e){if(ie.isDocumentKey(e))throw new x(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ue(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function he(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":D(12329,{type:typeof e})}function le(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new x(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=he(e);throw new x(M.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function de(e,t){const n={typeString:e};return t&&(n.value=t),n}function fe(e,t){if(!ue(e))throw new x(M.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const s=t[r].typeString,i="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const o=e[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(void 0!==i&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new x(M.INVALID_ARGUMENT,n);return!0}const pe=-62135596800,me=1e6;class ge{static now(){return ge.fromMillis(Date.now())}static fromDate(e){return ge.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*me);return new ge(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<pe)throw new x(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/me}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ge._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(fe(e,ge._jsonSchema))return new ge(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-pe;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ge._jsonSchemaVersion="firestore/timestamp/1.0",ge._jsonSchema={type:de("string",ge._jsonSchemaVersion),seconds:de("number"),nanoseconds:de("number")};class ye{static fromTimestamp(e){return new ye(e)}static min(){return new ye(new ge(0,0))}static max(){return new ye(new ge(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function ve(e){return new we(e.readTime,e.key,-1)}class we{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new we(ye.min(),ie.empty(),-1)}static max(){return new we(ye.max(),ie.empty(),-1)}}function _e(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ie.comparator(e.documentKey,t.documentKey),0!==n?n:W(e.largestBatchId,t.largestBatchId))}const Ee="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ie{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function be(e){if(e.code!==M.FAILED_PRECONDITION||e.message!==Ee)throw e;k("LocalStore","Unexpectedly lost primary lease")}class Te{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&D(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Te((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Te?t:Te.resolve(t)}catch(e){return Te.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Te.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Te.reject(t)}static resolve(e){return new Te((t,n)=>{t(e)})}static reject(e){return new Te((t,n)=>{n(e)})}static waitFor(e){return new Te((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=Te.resolve(!1);for(const n of e)t=t.next(e=>e?Te.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Te((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===s&&n(i)},e=>r(e))}})}static doWhile(e,t){return new Te((n,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):n()};s()})}}function Se(e){return"IndexedDbTransactionError"===e.name}class Ce{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ce.ce=-1;const ke=-1;function Ae(e){return null==e}function Ne(e){return 0===e&&1/e==-1/0}function Re(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function De(e){return e+""}const Pe="owner",Oe="mutationQueues",Le="mutations",Me="documentMutations",xe="remoteDocumentGlobal",Ve="targets",Ue="targetDocuments",Fe="targetGlobal",Be="collectionParents",je="clientMetadata",qe="bundles",$e="namedQueries";function ze(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function He(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ke(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ge{constructor(e,t){this.comparator=e,this.root=t||Qe.EMPTY}insert(e,t){return new Ge(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qe.BLACK,null,null))}remove(e){return new Ge(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new We(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new We(this.root,e,this.comparator,!1)}getReverseIterator(){return new We(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new We(this.root,e,this.comparator,!0)}}class We{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qe{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Qe.RED,this.left=null!=r?r:Qe.EMPTY,this.right=null!=s?s:Qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Qe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Qe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Qe.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw D(43730,{key:this.key,value:this.value});if(this.right.isRed())throw D(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw D(27949);return e+(this.isRed()?0:1)}}Qe.EMPTY=null,Qe.RED=!0,Qe.BLACK=!1,Qe.EMPTY=new class{constructor(){this.size=0}get key(){throw D(57766)}get value(){throw D(16141)}get color(){throw D(16727)}get left(){throw D(29726)}get right(){throw D(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new Qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Je{constructor(e){this.comparator=e,this.data=new Ge(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Xe(this.data.getIterator())}getIteratorFrom(e){return new Xe(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Je))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Je(this.comparator);return t.data=e,t}}class Xe{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ye{constructor(e){this.fields=e,e.sort(se.comparator)}static empty(){return new Ye([])}unionWith(e){let t=new Je(se.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ye(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Z(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ze extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class et{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ze("Invalid base64 string: "+e):e}}(e);return new et(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new et(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}et.EMPTY_BYTE_STRING=new et("");const tt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nt(e){if(O(!!e,39018),"string"==typeof e){let t=0;const n=tt.exec(e);if(O(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:rt(e.seconds),nanos:rt(e.nanos)}}function rt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function st(e){return"string"==typeof e?et.fromBase64String(e):et.fromUint8Array(e)}const it="server_timestamp",ot="__type__",at="__previous_value__",ct="__local_write_time__";function ut(e){const t=(e?.mapValue?.fields||{})[ot]?.stringValue;return t===it}function ht(e){const t=e.mapValue.fields[at];return ut(t)?ht(t):t}function lt(e){const t=nt(e.mapValue.fields[ct].timestampValue);return new ge(t.seconds,t.nanos)}class dt{constructor(e,t,n,r,s,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const ft="(default)";class pt{constructor(e,t){this.projectId=e,this.database=t||ft}static empty(){return new pt("","")}get isDefaultDatabase(){return this.database===ft}isEqual(e){return e instanceof pt&&e.projectId===this.projectId&&e.database===this.database}}const mt="__type__",gt="__max__",yt={fields:{__type__:{stringValue:gt}}},vt="__vector__",wt="value";function _t(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ut(e)?4:Vt(e)?9007199254740991:Mt(e)?10:11:D(28295,{value:e})}function Et(e,t){if(e===t)return!0;const n=_t(e);if(n!==_t(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return lt(e).isEqual(lt(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=nt(e.timestampValue),r=nt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return st(e.bytesValue).isEqual(st(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return rt(e.geoPointValue.latitude)===rt(t.geoPointValue.latitude)&&rt(e.geoPointValue.longitude)===rt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return rt(e.integerValue)===rt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=rt(e.doubleValue),r=rt(t.doubleValue);return n===r?Ne(n)===Ne(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Z(e.arrayValue.values||[],t.arrayValue.values||[],Et);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ze(n)!==ze(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Et(n[e],r[e])))return!1;return!0}(e,t);default:return D(52216,{left:e})}}function It(e,t){return void 0!==(e.values||[]).find(e=>Et(e,t))}function bt(e,t){if(e===t)return 0;const n=_t(e),r=_t(t);if(n!==r)return W(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return W(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=rt(e.integerValue||e.doubleValue),r=rt(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Tt(e.timestampValue,t.timestampValue);case 4:return Tt(lt(e),lt(t));case 5:return Q(e.stringValue,t.stringValue);case 6:return function(e,t){const n=st(e),r=st(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=W(n[e],r[e]);if(0!==t)return t}return W(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=W(rt(e.latitude),rt(t.latitude));return 0!==n?n:W(rt(e.longitude),rt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return St(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=t.fields||{},s=n[wt]?.arrayValue,i=r[wt]?.arrayValue,o=W(s?.values?.length||0,i?.values?.length||0);return 0!==o?o:St(s,i)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===yt&&t===yt)return 0;if(e===yt)return 1;if(t===yt)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=Q(r[e],i[e]);if(0!==t)return t;const o=bt(n[r[e]],s[i[e]]);if(0!==o)return o}return W(r.length,i.length)}(e.mapValue,t.mapValue);default:throw D(23264,{he:n})}}function Tt(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return W(e,t);const n=nt(e),r=nt(t),s=W(n.seconds,r.seconds);return 0!==s?s:W(n.nanos,r.nanos)}function St(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=bt(n[e],r[e]);if(t)return t}return W(n.length,r.length)}function Ct(e){return kt(e)}function kt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=nt(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return st(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ie.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=kt(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${kt(e.fields[s])}`;return n+"}"}(e.mapValue):D(61005,{value:e})}function At(e){switch(_t(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ht(e);return t?16+At(t):16;case 5:return 2*e.stringValue.length;case 6:return st(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+At(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return He(e.fields,(e,n)=>{t+=e.length+At(n)}),t}(e.mapValue);default:throw D(13486,{value:e})}}function Nt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Rt(e){return!!e&&"integerValue"in e}function Dt(e){return!!e&&"arrayValue"in e}function Pt(e){return!!e&&"nullValue"in e}function Ot(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Lt(e){return!!e&&"mapValue"in e}function Mt(e){const t=(e?.mapValue?.fields||{})[mt]?.stringValue;return t===vt}function xt(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return He(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=xt(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=xt(e.arrayValue.values[n]);return t}return{...e}}function Vt(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===gt}class Ut{constructor(e){this.value=e}static empty(){return new Ut({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Lt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xt(t)}setAll(e){let t=se.emptyPath(),n={},r=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=xt(e):r.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());Lt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Lt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){He(t,(t,n)=>e[t]=n);for(const t of n)delete e[t]}clone(){return new Ut(xt(this.value))}}function Ft(e){const t=[];return He(e.fields,(e,n)=>{const r=new se([e]);if(Lt(n)){const e=Ft(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new Ye(t)}class Bt{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Bt(e,0,ye.min(),ye.min(),ye.min(),Ut.empty(),0)}static newFoundDocument(e,t,n,r){return new Bt(e,1,t,ye.min(),n,r,0)}static newNoDocument(e,t){return new Bt(e,2,t,ye.min(),ye.min(),Ut.empty(),0)}static newUnknownDocument(e,t){return new Bt(e,3,t,ye.min(),ye.min(),Ut.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ye.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ut.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ut.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Bt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class jt{constructor(e,t){this.position=e,this.inclusive=t}}function qt(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?ie.comparator(ie.fromName(o.referenceValue),n.key):bt(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function $t(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Et(e.position[n],t.position[n]))return!1;return!0}class zt{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ht(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Kt{}class Gt extends Kt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new en(e,t,n):"array-contains"===t?new sn(e,n):"in"===t?new on(e,n):"not-in"===t?new an(e,n):"array-contains-any"===t?new cn(e,n):new Gt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new tn(e,n):new nn(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(bt(t,this.value)):null!==t&&_t(this.value)===_t(t)&&this.matchesComparison(bt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return D(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wt extends Kt{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Wt(e,t)}matches(e){return Qt(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qt(e){return"and"===e.op}function Jt(e){return function(e){for(const t of e.filters)if(t instanceof Wt)return!1;return!0}(e)&&Qt(e)}function Xt(e){if(e instanceof Gt)return e.field.canonicalString()+e.op.toString()+Ct(e.value);if(Jt(e))return e.filters.map(e=>Xt(e)).join(",");{const t=e.filters.map(e=>Xt(e)).join(",");return`${e.op}(${t})`}}function Yt(e,t){return e instanceof Gt?function(e,t){return t instanceof Gt&&e.op===t.op&&e.field.isEqual(t.field)&&Et(e.value,t.value)}(e,t):e instanceof Wt?function(e,t){return t instanceof Wt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Yt(n,t.filters[r]),!0)}(e,t):void D(19439)}function Zt(e){return e instanceof Gt?function(e){return`${e.field.canonicalString()} ${e.op} ${Ct(e.value)}`}(e):e instanceof Wt?function(e){return e.op.toString()+" {"+e.getFilters().map(Zt).join(" ,")+"}"}(e):"Filter"}class en extends Gt{constructor(e,t,n){super(e,t,n),this.key=ie.fromName(n.referenceValue)}matches(e){const t=ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class tn extends Gt{constructor(e,t){super(e,"in",t),this.keys=rn(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nn extends Gt{constructor(e,t){super(e,"not-in",t),this.keys=rn(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rn(e,t){return(t.arrayValue?.values||[]).map(e=>ie.fromName(e.referenceValue))}class sn extends Gt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Dt(t)&&It(t.arrayValue,this.value)}}class on extends Gt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&It(this.value.arrayValue,t)}}class an extends Gt{constructor(e,t){super(e,"not-in",t)}matches(e){if(It(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!It(this.value.arrayValue,t)}}class cn extends Gt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Dt(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>It(this.value.arrayValue,e))}}class un{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.Te=null}}function hn(e,t=null,n=[],r=[],s=null,i=null,o=null){return new un(e,t,n,r,s,i,o)}function ln(e){const t=L(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Xt(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ae(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ct(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ct(e)).join(",")),t.Te=e}return t.Te}function dn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ht(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Yt(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!$t(e.startAt,t.startAt)&&$t(e.endAt,t.endAt)}function fn(e){return ie.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class pn{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function mn(e){return new pn(e)}function gn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function yn(e){return null!==e.collectionGroup}function vn(e){const t=L(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ie.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Je(se.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new zt(r,n))}),e.has(se.keyField().canonicalString())||t.Ie.push(new zt(se.keyField(),n))}return t.Ie}function wn(e){const t=L(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return hn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new zt(e.field,t)});const n=e.endAt?new jt(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new jt(e.startAt.position,e.startAt.inclusive):null;return hn(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,vn(e))),t.Ee}function _n(e,t){const n=e.filters.concat([t]);return new pn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function En(e,t,n){return new pn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function In(e,t){return dn(wn(e),wn(t))&&e.limitType===t.limitType}function bn(e){return`${ln(wn(e))}|lt:${e.limitType}`}function Tn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Zt(e)).join(", ")}]`),Ae(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ct(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ct(e)).join(",")),`Target(${t})`}(wn(e))}; limitType=${e.limitType})`}function Sn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ie.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of vn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=qt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,vn(e),t)||e.endAt&&!function(e,t,n){const r=qt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,vn(e),t))}(e,t)}function Cn(e){return(t,n)=>{let r=!1;for(const s of vn(e)){const e=kn(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function kn(e,t,n){const r=e.field.isKeyField()?ie.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?bt(r,s):D(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return D(19790,{direction:e.dir})}}class An{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){He(this.inner,(t,n)=>{for(const[t,r]of n)e(t,r)})}isEmpty(){return Ke(this.inner)}size(){return this.innerSize}}const Nn=new Ge(ie.comparator);function Rn(){return Nn}const Dn=new Ge(ie.comparator);function Pn(...e){let t=Dn;for(const n of e)t=t.insert(n.key,n);return t}function On(e){let t=Dn;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Ln(){return xn()}function Mn(){return xn()}function xn(){return new An(e=>e.toString(),(e,t)=>e.isEqual(t))}const Vn=new Ge(ie.comparator),Un=new Je(ie.comparator);function Fn(...e){let t=Un;for(const n of e)t=t.add(n);return t}const Bn=new Je(W);function jn(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ne(t)?"-0":t}}function qn(e){return{integerValue:""+e}}function $n(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ne(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?qn(t):jn(e,t)}class zn{constructor(){this._=void 0}}function Hn(e,t,n){return e instanceof Wn?function(e,t){const n={fields:{[ot]:{stringValue:it},[ct]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ut(t)&&(t=ht(t)),t&&(n.fields[at]=t),{mapValue:n}}(n,t):e instanceof Qn?Jn(e,t):e instanceof Xn?Yn(e,t):function(e,t){const n=Gn(e,t),r=er(n)+er(e.Ae);return Rt(n)&&Rt(e.Ae)?qn(r):jn(e.serializer,r)}(e,t)}function Kn(e,t,n){return e instanceof Qn?Jn(e,t):e instanceof Xn?Yn(e,t):n}function Gn(e,t){return e instanceof Zn?function(e){return Rt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Wn extends zn{}class Qn extends zn{constructor(e){super(),this.elements=e}}function Jn(e,t){const n=tr(t);for(const t of e.elements)n.some(e=>Et(e,t))||n.push(t);return{arrayValue:{values:n}}}class Xn extends zn{constructor(e){super(),this.elements=e}}function Yn(e,t){let n=tr(t);for(const t of e.elements)n=n.filter(e=>!Et(e,t));return{arrayValue:{values:n}}}class Zn extends zn{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function er(e){return rt(e.integerValue||e.doubleValue)}function tr(e){return Dt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nr{constructor(e,t){this.field=e,this.transform=t}}class rr{constructor(e,t){this.version=e,this.transformResults=t}}class sr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sr}static exists(e){return new sr(void 0,e)}static updateTime(e){return new sr(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ir(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class or{}function ar(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new yr(e.key,sr.none()):new dr(e.key,e.data,sr.none());{const n=e.data,r=Ut.empty();let s=new Je(se.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new fr(e.key,r,new Ye(s.toArray()),sr.none())}}function cr(e,t,n){e instanceof dr?function(e,t,n){const r=e.value.clone(),s=mr(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof fr?function(e,t,n){if(!ir(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=mr(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(pr(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ur(e,t,n,r){return e instanceof dr?function(e,t,n,r){if(!ir(e.precondition,t))return n;const s=e.value.clone(),i=gr(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof fr?function(e,t,n,r){if(!ir(e.precondition,t))return n;const s=gr(e.fieldTransforms,r,t),i=t.data;return i.setAll(pr(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return ir(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function hr(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Gn(r.transform,e||null);null!=s&&(null===n&&(n=Ut.empty()),n.set(r.field,s))}return n||null}function lr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Z(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Qn&&t instanceof Qn||e instanceof Xn&&t instanceof Xn?Z(e.elements,t.elements,Et):e instanceof Zn&&t instanceof Zn?Et(e.Ae,t.Ae):e instanceof Wn&&t instanceof Wn}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class dr extends or{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class fr extends or{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function pr(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function mr(e,t,n){const r=new Map;O(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Kn(o,a,n[s]))}return r}function gr(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,Hn(e,i,t))}return r}class yr extends or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vr extends or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class wr{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&cr(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ur(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ur(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Mn();return this.mutations.forEach(r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=ar(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(ye.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Fn())}isEqual(e){return this.batchId===e.batchId&&Z(this.mutations,e.mutations,(e,t)=>lr(e,t))&&Z(this.baseMutations,e.baseMutations,(e,t)=>lr(e,t))}}class _r{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){O(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=Vn;const s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new _r(e,t,n,r)}}class Er{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ir{constructor(e,t){this.count=e,this.unchangedNames=t}}var br,Tr;function Sr(e){if(void 0===e)return A("GRPC error has no .code"),M.UNKNOWN;switch(e){case br.OK:return M.OK;case br.CANCELLED:return M.CANCELLED;case br.UNKNOWN:return M.UNKNOWN;case br.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case br.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case br.INTERNAL:return M.INTERNAL;case br.UNAVAILABLE:return M.UNAVAILABLE;case br.UNAUTHENTICATED:return M.UNAUTHENTICATED;case br.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case br.NOT_FOUND:return M.NOT_FOUND;case br.ALREADY_EXISTS:return M.ALREADY_EXISTS;case br.PERMISSION_DENIED:return M.PERMISSION_DENIED;case br.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case br.ABORTED:return M.ABORTED;case br.OUT_OF_RANGE:return M.OUT_OF_RANGE;case br.UNIMPLEMENTED:return M.UNIMPLEMENTED;case br.DATA_LOSS:return M.DATA_LOSS;default:return D(39323,{code:e})}}(Tr=br||(br={}))[Tr.OK=0]="OK",Tr[Tr.CANCELLED=1]="CANCELLED",Tr[Tr.UNKNOWN=2]="UNKNOWN",Tr[Tr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Tr[Tr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Tr[Tr.NOT_FOUND=5]="NOT_FOUND",Tr[Tr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Tr[Tr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Tr[Tr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Tr[Tr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Tr[Tr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Tr[Tr.ABORTED=10]="ABORTED",Tr[Tr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Tr[Tr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Tr[Tr.INTERNAL=13]="INTERNAL",Tr[Tr.UNAVAILABLE=14]="UNAVAILABLE",Tr[Tr.DATA_LOSS=15]="DATA_LOSS";const Cr=new r([4294967295,4294967295],0);function kr(e){const t=(new TextEncoder).encode(e),n=new s;return n.update(t),new Uint8Array(n.digest())}function Ar(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),i=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new r([n,s],0),new r([i,o],0)]}class Nr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Rr(`Invalid padding: ${t}`);if(n<0)throw new Rr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Rr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Rr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=r.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(r.fromNumber(n)));return 1===s.compare(Cr)&&(s=new r([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=kr(e),[n,r]=Ar(t);for(let e=0;e<this.hashCount;e++){const t=this.ye(n,r,e);if(!this.we(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new Nr(s,r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=kr(e),[n,r]=Ar(t);for(let e=0;e<this.hashCount;e++){const t=this.ye(n,r,e);this.Se(t)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Rr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Dr{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Pr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Dr(ye.min(),r,new Ge(W),Rn(),Fn())}}class Pr{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Pr(n,t,Fn(),Fn(),Fn())}}class Or{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class Lr{constructor(e,t){this.targetId=e,this.Ce=t}}class Mr{constructor(e,t,n=et.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class xr{constructor(){this.ve=0,this.Fe=Fr(),this.Me=et.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Fn(),t=Fn(),n=Fn();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:D(38017,{changeType:s})}}),new Pr(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=Fr()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,O(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Vr{constructor(e){this.Ge=e,this.ze=new Map,this.je=Rn(),this.Je=Ur(),this.He=Ur(),this.Ye=new Ge(W)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:D(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(fn(s))if(0===n){const e=new ie(s.path);this.et(t,e,Bt.newNoDocument(e,ye.min()))}else O(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){const n=this.ut(e),s=n?this.ct(n,e,r):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,o;try{i=st(n).toUint8Array()}catch(e){if(e instanceof Ze)return N("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Nr(i,r,s)}catch(e){return N(e instanceof Rr?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const s=this.Ge.ht(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const s=this.ot(r);if(s){if(n.current&&fn(s.target)){const t=new ie(s.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Bt.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=Fn();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new Dr(e,t,this.Ye,this.je,n);return this.je=Rn(),this.Je=Ur(),this.He=Ur(),this.Ye=new Ge(W),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new xr,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Je(W),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Je(W),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||k("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new xr),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ur(){return new Ge(ie.comparator)}function Fr(){return new Ge(ie.comparator)}const Br={asc:"ASCENDING",desc:"DESCENDING"},jr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qr={and:"AND",or:"OR"};class $r{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function zr(e,t){return e.useProto3Json||Ae(t)?t:{value:t}}function Hr(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Kr(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Gr(e,t){return Hr(e,t.toTimestamp())}function Wr(e){return O(!!e,49232),ye.fromTimestamp(function(e){const t=nt(e);return new ge(t.seconds,t.nanos)}(e))}function Qr(e,t){return Jr(e,t).canonicalString()}function Jr(e,t){const n=function(e){return new ne(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Xr(e){const t=ne.fromString(e);return O(ms(t),10190,{key:t.toString()}),t}function Yr(e,t){return Qr(e.databaseId,t.path)}function Zr(e,t){const n=Xr(t);if(n.get(1)!==e.databaseId.projectId)throw new x(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new x(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ie(ns(n))}function es(e,t){return Qr(e.databaseId,t)}function ts(e){return new ne(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ns(e){return O(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function rs(e,t,n){return{name:Yr(e,t),fields:n.value.mapValue.fields}}function ss(e,t){return{documents:[es(e,t.path)]}}function is(e,t){const n={structuredQuery:{}},r=t.path;let s;null!==t.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=es(e,s);const i=function(e){if(0!==e.length)return fs(Wt.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:ls(e.field),direction:cs(e.dir)}}(e))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=zr(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:s}}function os(e){let t=function(e){const t=Xr(e);return 4===t.length?ne.emptyPath():ns(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){O(1===r,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=as(e);return t instanceof Wt&&Jt(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new zt(ds(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ae(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new jt(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new jt(n,t)}(n.endAt)),function(e,t,n,r,s,i,o,a){return new pn(e,t,n,r,s,i,o,a)}(t,s,o,i,a,"F",c,u)}function as(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ds(e.unaryFilter.field);return Gt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=ds(e.unaryFilter.field);return Gt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ds(e.unaryFilter.field);return Gt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ds(e.unaryFilter.field);return Gt.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return D(61313);default:return D(60726)}}(e):void 0!==e.fieldFilter?function(e){return Gt.create(ds(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return D(58110);default:return D(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Wt.create(e.compositeFilter.filters.map(e=>as(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return D(1026)}}(e.compositeFilter.op))}(e):D(30097,{filter:e})}function cs(e){return Br[e]}function us(e){return jr[e]}function hs(e){return qr[e]}function ls(e){return{fieldPath:e.canonicalString()}}function ds(e){return se.fromServerFormat(e.fieldPath)}function fs(e){return e instanceof Gt?function(e){if("=="===e.op){if(Ot(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NAN"}};if(Pt(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ot(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NOT_NAN"}};if(Pt(e.value))return{unaryFilter:{field:ls(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ls(e.field),op:us(e.op),value:e.value}}}(e):e instanceof Wt?function(e){const t=e.getFilters().map(e=>fs(e));return 1===t.length?t[0]:{compositeFilter:{op:hs(e.op),filters:t}}}(e):D(54877,{filter:e})}function ps(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ms(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class gs{constructor(e,t,n,r,s=ye.min(),i=ye.min(),o=et.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new gs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ys{constructor(e){this.yt=e}}function vs(e){const t=os({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?En(t,t.limit,"L"):t}class ws{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(rt(e.integerValue));else if("doubleValue"in e){const n=rt(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Ne(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=nt(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(st(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Vt(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Mt(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):D(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const e of Object.keys(n))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const r=wt,s=n[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(rt(s)),this.Ot(r,t),this.Ct(n[r],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const e of n)this.Ct(e,t)}Lt(e,t){this.Ft(t,37),ie.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ws.Kt=new ws;class _s{constructor(){this.Cn=new Es}addToCollectionParentIndex(e,t){return this.Cn.add(t),Te.resolve()}getCollectionParents(e,t){return Te.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Te.resolve()}deleteFieldIndex(e,t){return Te.resolve()}deleteAllFieldIndexes(e){return Te.resolve()}createTargetIndexes(e,t){return Te.resolve()}getDocumentsMatchingTarget(e,t){return Te.resolve(null)}getIndexType(e,t){return Te.resolve(0)}getFieldIndexes(e,t){return Te.resolve([])}getNextCollectionGroupToUpdate(e){return Te.resolve(null)}getMinOffset(e,t){return Te.resolve(we.min())}getMinOffsetFromCollectionGroup(e,t){return Te.resolve(we.min())}updateCollectionGroup(e,t,n){return Te.resolve()}updateIndexEntries(e,t){return Te.resolve()}}class Es{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Je(ne.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Je(ne.comparator)).toArray()}}new Uint8Array(0);const Is={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bs=41943040;class Ts{static withCacheSize(e){return new Ts(e,Ts.DEFAULT_COLLECTION_PERCENTILE,Ts.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Ts.DEFAULT_COLLECTION_PERCENTILE=10,Ts.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ts.DEFAULT=new Ts(bs,Ts.DEFAULT_COLLECTION_PERCENTILE,Ts.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ts.DISABLED=new Ts(-1,0,0);class Ss{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ss(0)}static cr(){return new Ss(-1)}}const Cs="LruGarbageCollector";function ks([e,t],[n,r]){const s=W(e,n);return 0===s?W(t,r):s}class As{constructor(e){this.Ir=e,this.buffer=new Je(ks),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ks(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ns{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){k(Cs,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Se(e)?k(Cs,"Ignoring IndexedDB error during garbage collection: ",e):await be(e)}await this.Vr(3e5)})}}class Rs{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Te.resolve(Ce.ce);const n=new As(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector","Garbage collection skipped; disabled"),Te.resolve(Is)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Is):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,s,i,o,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(s=t,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),C()<=a.$b.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),Te.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e})))}}class Ds{constructor(){this.changes=new An(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Bt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Te.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ps{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Os{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ur(n.mutation,e,Ye.empty(),ge.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Fn()).next(()=>t))}getLocalViewOfDocuments(e,t,n=Fn()){const r=Ln();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Pn();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Ln();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Fn()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let s=Rn();const i=xn(),o=xn();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof fr)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),ur(o.mutation,t,o.mutation.getFieldMask(),ge.now())):i.set(t.key,Ye.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>o.set(e,new Ps(t,i.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){const n=xn();let r=new Ge((e,t)=>e-t),s=Fn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Ye.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||Fn()).add(e);r=r.insert(s.batchId,a)})}).next(()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Mn();c.forEach(e=>{if(!s.has(e)){const r=ar(t.get(e),n.get(e));null!==r&&u.set(e,r),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Te.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ie.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):Te.resolve(Ln());let o=-1,a=s;return i.next(t=>Te.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?Te.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,Fn())).next(e=>({batchId:o,changes:On(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ie(t)).next(e=>{let t=Pn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=Pn();return this.indexManager.getCollectionParents(e,s).next(o=>Te.forEach(o,o=>{const a=function(e,t){return new pn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r))).next(e=>{s.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Bt.newInvalidDocument(r)))});let n=Pn();return e.forEach((e,r)=>{const i=s.get(e);void 0!==i&&ur(i.mutation,r,Ye.empty(),ge.now()),Sn(t,r)&&(n=n.insert(e,r))}),n})}}class Ls{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Te.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Wr(e.createTime)}}(t)),Te.resolve()}getNamedQuery(e,t){return Te.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:vs(e.bundledQuery),readTime:Wr(e.readTime)}}(t)),Te.resolve()}}class Ms{constructor(){this.overlays=new Ge(ie.comparator),this.qr=new Map}getOverlay(e,t){return Te.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ln();return Te.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),Te.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),Te.resolve()}getOverlaysForCollection(e,t,n){const r=Ln(),s=t.length+1,i=new ie(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Te.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Ge((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Ln(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ln(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return Te.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Er(t,n));let s=this.qr.get(t);void 0===s&&(s=Fn(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class xs{constructor(){this.sessionToken=et.EMPTY_BYTE_STRING}getSessionToken(e){return Te.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Te.resolve()}}class Vs{constructor(){this.Qr=new Je(Us.$r),this.Ur=new Je(Us.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Us(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new Us(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new ie(new ne([])),n=new Us(t,e),r=new Us(t,e+1),s=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),s.push(e.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ie(new ne([])),n=new Us(t,e),r=new Us(t,e+1);let s=Fn();return this.Ur.forEachInRange([n,r],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new Us(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Us{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ie.comparator(e.key,t.key)||W(e.Yr,t.Yr)}static Kr(e,t){return W(e.Yr,t.Yr)||ie.comparator(e.key,t.key)}}class Fs{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Je(Us.$r)}checkEmpty(e){return Te.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new wr(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.Zr=this.Zr.add(new Us(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Te.resolve(i)}lookupMutationBatch(e,t){return Te.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),s=r<0?0:r;return Te.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Te.resolve(0===this.mutationQueue.length?ke:this.tr-1)}getAllMutationBatches(e){return Te.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Us(t,0),r=new Us(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],e=>{const t=this.Xr(e.Yr);s.push(t)}),Te.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Je(W);return t.forEach(e=>{const t=new Us(e,0),r=new Us(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),Te.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;ie.isDocumentKey(s)||(s=s.child(""));const i=new Us(new ie(s),0);let o=new Je(W);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},i),Te.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){O(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return Te.forEach(t.mutations,r=>{const s=new Us(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new Us(t,0),r=this.Zr.firstAfterOrEqual(n);return Te.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Te.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Bs{constructor(e){this.ri=e,this.docs=new Ge(ie.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Te.resolve(n?n.document.mutableCopy():Bt.newInvalidDocument(t))}getEntries(e,t){let n=Rn();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Bt.newInvalidDocument(e))}),Te.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=Rn();const i=t.path,o=new ie(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||_e(ve(o),n)<=0||(r.has(o.key)||Sn(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Te.resolve(s)}getAllFromCollectionGroup(e,t,n,r){D(9500)}ii(e,t){return Te.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new js(this)}getSize(e){return Te.resolve(this.size)}}class js extends Ds{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),Te.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class qs{constructor(e){this.persistence=e,this.si=new An(e=>ln(e),dn),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.oi=0,this._i=new Vs,this.targetCount=0,this.ai=Ss.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),Te.resolve()}getLastRemoteSnapshotVersion(e){return Te.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Te.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Te.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),Te.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ss(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Te.resolve()}updateTargetData(e,t){return this.Pr(t),Te.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Te.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Te.waitFor(s).next(()=>r)}getTargetCount(e){return Te.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return Te.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),Te.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(t=>{s.push(r.markPotentiallyOrphaned(e,t))}),Te.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Te.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return Te.resolve(n)}containsKey(e,t){return Te.resolve(this._i.containsKey(t))}}class $s{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ce(0),this.li=!1,this.li=!0,this.hi=new xs,this.referenceDelegate=e(this),this.Pi=new qs(this),this.indexManager=new _s,this.remoteDocumentCache=function(e){return new Bs(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new ys(t),this.Ii=new Ls(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ms,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Fs(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);const r=new zs(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return Te.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class zs extends Ie{constructor(e){super(),this.currentSequenceNumber=e}}class Hs{constructor(e){this.persistence=e,this.Ri=new Vs,this.Vi=null}static mi(e){return new Hs(e)}get fi(){if(this.Vi)return this.Vi;throw D(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),Te.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),Te.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Te.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Te.forEach(this.fi,n=>{const r=ie.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,ye.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Te.or([()=>Te.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ks{constructor(e,t){this.persistence=e,this.pi=new An(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=De(t)),t=Re(e.get(n),t);return De(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Rs(e,t)}(this,t)}static mi(e,t){return new Ks(e,t)}Ei(){}di(e){return Te.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return Te.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?Te.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,s.removeEntry(r,ye.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Te.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),Te.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),Te.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Te.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=At(e.data.value)),t}br(e,t,n){return Te.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return Te.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Gs{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=Fn(),r=Fn();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Gs(e,t.fromCache,n,r)}}class Ws{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Qs{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,c.nr)()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}((0,c.ZQ)())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ys(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ws(e,t,r,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new Ws;return this.Ss(e,t,n).next(r=>{if(s.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>s.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(C()<=a.$b.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Tn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Te.resolve()):(C()<=a.$b.DEBUG&&k("QueryEngine","Query:",Tn(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(C()<=a.$b.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Tn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wn(t))):Te.resolve())}ys(e,t){if(gn(t))return Te.resolve(null);let n=wn(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=En(t,null,"F"),n=wn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const s=Fn(...r);return this.ps.getDocuments(e,s).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.Ds(t,r);return this.Cs(t,i,s,n.readTime)?this.ys(e,En(t,null,"F")):this.vs(e,i,t,n)}))})))}ws(e,t,n,r){return gn(t)||r.isEqual(ye.min())?Te.resolve(null):this.ps.getDocuments(e,n).next(s=>{const i=this.Ds(t,s);return this.Cs(t,i,n,r)?Te.resolve(null):(C()<=a.$b.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Tn(t)),this.vs(e,i,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=ye.fromTimestamp(1e9===r?new ge(n+1,0):new ge(n,r));return new we(s,ie.empty(),t)}(r,-1)).next(e=>e))})}Ds(e,t){let n=new Je(Cn(e));return t.forEach((t,r)=>{Sn(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,n){return C()<=a.$b.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Tn(t)),this.ps.getDocumentsMatchingQuery(e,t,we.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const Js="LocalStore",Xs=3e8;class Ys{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Ge(W),this.xs=new An(e=>ln(e),dn),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Os(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function Zs(e,t){const n=L(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(s=>(r=s,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let o=Fn();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:s,addedBatchIds:i}))})})}function ei(e){const t=L(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function ti(e,t){const n=L(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=ke),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function ni(e,t,n){const r=L(e),s=r.Ms.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!Se(e))throw e;k(Js,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function ri(e,t,n){const r=L(e);let s=ye.min(),i=Fn();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=L(e),s=r.xs.get(n);return void 0!==s?Te.resolve(r.Ms.get(s)):r.Pi.getTargetData(t,n)}(r,e,wn(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,n?s:ye.min(),n?i:Fn())).next(e=>(function(e,t,n){let r=e.Os.get(t)||ye.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class si{constructor(){this.activeTargetIds=Bn}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ii{constructor(){this.Mo=new si,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new si,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class oi{Oo(e){}shutdown(){}}const ai="ConnectivityMonitor";class ci{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){k(ai,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){k(ai,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ui=null;function hi(){return null===ui?ui=268435456+Math.round(2147483648*Math.random()):ui++,"0x"+ui.toString(16)}const li="RestConnection",di={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class fi{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===ft?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,s){const i=hi(),o=this.zo(e,t.toUriEncodedString());k(li,`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,s);const{host:u}=new URL(o),h=(0,c.zJ)(u);return this.Jo(e,o,a,n,h).then(t=>(k(li,`Received RPC '${e}' ${i}: `,t),t),t=>{throw N(li,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,s,i){return this.Go(e,t,n,r,s)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+T,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=di[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class pi{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const mi="WebChannelConnection";class gi extends fi{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,s){const i=hi();return new Promise((s,o)=>{const a=new l;a.setWithCredentials(!0),a.listenOnce(f.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const t=a.getResponseJson();k(mi,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case p.TIMEOUT:k(mi,`RPC '${e}' ${i} timed out`),o(new x(M.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const n=a.getStatus();if(k(mi,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(t)>=0?t:M.UNKNOWN}(t.status);o(new x(e,t.message))}else o(new x(M.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new x(M.UNAVAILABLE,"Connection failed."));break;default:D(9055,{l_:e,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{k(mi,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(r);k(mi,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)})}T_(e,t,n){const r=hi(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=v(),o=y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=s.join("");k(mi,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=i.createWebChannel(u,a);this.I_(h);let l=!1,f=!1;const p=new pi({Yo:t=>{f?k(mi,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(k(mi,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),k(mi,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Zo:()=>h.close()}),w=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return w(h,d.EventType.OPEN,()=>{f||(k(mi,`RPC '${e}' stream ${r} transport opened.`),p.o_())}),w(h,d.EventType.CLOSE,()=>{f||(f=!0,k(mi,`RPC '${e}' stream ${r} transport closed`),p.a_(),this.E_(h))}),w(h,d.EventType.ERROR,t=>{f||(f=!0,N(mi,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),p.a_(new x(M.UNAVAILABLE,"The operation could not be completed")))}),w(h,d.EventType.MESSAGE,t=>{if(!f){const n=t.data[0];O(!!n,16349);const s=n,i=s?.error||s[0]?.error;if(i){k(mi,`RPC '${e}' stream ${r} received error:`,i);const t=i.status;let n=function(e){const t=br[e];if(void 0!==t)return Sr(t)}(t),s=i.message;void 0===n&&(n=M.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),f=!0,p.a_(new x(n,s)),h.close()}else k(mi,`RPC '${e}' stream ${r} received:`,n),p.u_(n)}}),w(o,g.STAT_EVENT,t=>{t.stat===m.PROXY?k(mi,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===m.NOPROXY&&k(mi,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function yi(){return"undefined"!=typeof document?document:null}function vi(e){return new $r(e,!0)}class wi{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&k("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const _i="PersistentStream";class Ei{constructor(e,t,n,r,s,i,o,a){this.Mi=e,this.S_=n,this.b_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new wi(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(A(t.toString()),A("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new x(M.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return k(_i,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(k(_i,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ii extends Ei{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:D(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(O(void 0===t||"string"==typeof t,58123),et.fromBase64String(t||"")):(O(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),et.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?M.UNKNOWN:Sr(e.code);return new x(t,e.message||"")}(o);n=new Mr(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Zr(e,r.document.name),i=Wr(r.document.updateTime),o=r.document.createTime?Wr(r.document.createTime):ye.min(),a=new Ut({mapValue:{fields:r.document.fields}}),c=Bt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Or(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Zr(e,r.document),i=r.readTime?Wr(r.readTime):ye.min(),o=Bt.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Or([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Zr(e,r.document),i=r.removedTargetIds||[];n=new Or([],i,s,null)}else{if(!("filter"in t))return D(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new Ir(r,s),o=e.targetId;n=new Lr(o,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ye.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ye.min():t.readTime?Wr(t.readTime):ye.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=ts(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=fn(r)?{documents:ss(e,r)}:{query:is(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Kr(e,t.resumeToken);const r=zr(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ye.min())>0){n.readTime=Hr(e,t.snapshotVersion.toTimestamp());const r=zr(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return D(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=ts(this.serializer),t.removeTarget=e,this.q_(t)}}class bi extends Ei{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return O(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,O(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){O(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(O(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Wr(e.updateTime):Wr(t);return n.isEqual(ye.min())&&(n=Wr(t)),new rr(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Wr(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=ts(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof dr)n={update:rs(e,t.key,t.value)};else if(t instanceof yr)n={delete:Yr(e,t.key)};else if(t instanceof fr)n={update:rs(e,t.key,t.data),updateMask:ps(t.fieldMask)};else{if(!(t instanceof vr))return D(16599,{Vt:t.type});n={verify:Yr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Wn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Qn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Xn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Zn)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw D(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Gr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:D(27497)}(e,t.precondition)),n}(this.serializer,e))};this.q_(t)}}class Ti{}class Si extends Ti{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new x(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Go(e,Jr(t,n),r,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new x(M.UNKNOWN,e.toString())})}Ho(e,t,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Ho(e,Jr(t,n),r,i,o,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new x(M.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Ci{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(A(t),this.aa=!1):k("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const ki="RemoteStore";class Ai{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{Vi(this)&&(k(ki,"Restarting streams for network reachability change."),await async function(e){const t=L(e);t.Ea.add(4),await Ri(t),t.Ra.set("Unknown"),t.Ea.delete(4),await Ni(t)}(this))})}),this.Ra=new Ci(n,r)}}async function Ni(e){if(Vi(e))for(const t of e.da)await t(!0)}async function Ri(e){for(const t of e.da)await t(!1)}function Di(e,t){const n=L(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),xi(n)?Mi(n):to(n).O_()&&Oi(n,t))}function Pi(e,t){const n=L(e),r=to(n);n.Ia.delete(t),r.O_()&&Li(n,t),0===n.Ia.size&&(r.O_()?r.L_():Vi(n)&&n.Ra.set("Unknown"))}function Oi(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ye.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}to(e).Y_(t)}function Li(e,t){e.Va.Ue(t),to(e).Z_(t)}function Mi(e){e.Va=new Vr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),to(e).start(),e.Ra.ua()}function xi(e){return Vi(e)&&!to(e).x_()&&e.Ia.size>0}function Vi(e){return 0===L(e).Ea.size}function Ui(e){e.Va=void 0}async function Fi(e){e.Ra.set("Online")}async function Bi(e){e.Ia.forEach((t,n)=>{Oi(e,t)})}async function ji(e,t){Ui(e),xi(e)?(e.Ra.ha(t),Mi(e)):e.Ra.set("Unknown")}async function qi(e,t,n){if(e.Ra.set("Online"),t instanceof Mr&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){k(ki,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await $i(e,n)}else if(t instanceof Or?e.Va.Ze(t):t instanceof Lr?e.Va.st(t):e.Va.tt(t),!n.isEqual(ye.min()))try{const t=await ei(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ia.get(r);s&&e.Ia.set(r,s.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(et.EMPTY_BYTE_STRING,r.snapshotVersion)),Li(e,t);const s=new gs(r.target,t,n,r.sequenceNumber);Oi(e,s)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){k(ki,"Failed to raise snapshot:",t),await $i(e,t)}}async function $i(e,t,n){if(!Se(t))throw t;e.Ea.add(1),await Ri(e),e.Ra.set("Offline"),n||(n=()=>ei(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{k(ki,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await Ni(e)})}function zi(e,t){return t().catch(n=>$i(e,n,t))}async function Hi(e){const t=L(e),n=no(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:ke;for(;Ki(t);)try{const e=await ti(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,Gi(t,e)}catch(e){await $i(t,e)}Wi(t)&&Qi(t)}function Ki(e){return Vi(e)&&e.Ta.length<10}function Gi(e,t){e.Ta.push(t);const n=no(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Wi(e){return Vi(e)&&!no(e).x_()&&e.Ta.length>0}function Qi(e){no(e).start()}async function Ji(e){no(e).ra()}async function Xi(e){const t=no(e);for(const n of e.Ta)t.ea(n.mutations)}async function Yi(e,t,n){const r=e.Ta.shift(),s=_r.from(r,t,n);await zi(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await Hi(e)}async function Zi(e,t){t&&no(e).X_&&await async function(e,t){if(function(e){return function(e){switch(e){case M.OK:return D(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return D(15467,{code:e})}}(e)&&e!==M.ABORTED}(t.code)){const n=e.Ta.shift();no(e).B_(),await zi(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Hi(e)}}(e,t),Wi(e)&&Qi(e)}async function eo(e,t){const n=L(e);n.asyncQueue.verifyOperationInProgress(),k(ki,"RemoteStore received new credentials");const r=Vi(n);n.Ea.add(3),await Ri(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await Ni(n)}function to(e){return e.ma||(e.ma=function(e,t,n){const r=L(e);return r.sa(),new Ii(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:Fi.bind(null,e),t_:Bi.bind(null,e),r_:ji.bind(null,e),H_:qi.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),xi(e)?Mi(e):e.Ra.set("Unknown")):(await e.ma.stop(),Ui(e))})),e.ma}function no(e){return e.fa||(e.fa=function(e,t,n){const r=L(e);return r.sa(),new bi(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Ji.bind(null,e),r_:Zi.bind(null,e),ta:Xi.bind(null,e),na:Yi.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await Hi(e)):(await e.fa.stop(),e.Ta.length>0&&(k(ki,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ro{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new V,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new ro(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new x(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function so(e,t){if(A("AsyncQueue",`${t}: ${e}`),Se(e))return new x(M.UNAVAILABLE,`${t}: ${e}`);throw e}class io{static emptySet(e){return new io(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ie.comparator(t.key,n.key):(e,t)=>ie.comparator(e.key,t.key),this.keyedMap=Pn(),this.sortedSet=new Ge(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof io))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new io;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class oo{constructor(){this.ga=new Ge(ie.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):D(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class ao{constructor(e,t,n,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new ao(e,t,io.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&In(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class co{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class uo{constructor(){this.queries=ho(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=L(e),r=n.queries;n.queries=ho(),r.forEach((e,n)=>{for(const e of n.Sa)e.onError(t)})}(this,new x(M.ABORTED,"Firestore shutting down"))}}function ho(){return new An(e=>bn(e),In)}async function lo(e,t){const n=L(e);let r=3;const s=t.query;let i=n.queries.get(s);i?!i.ba()&&t.Da()&&(r=2):(i=new co,r=t.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=so(e,`Initialization of query '${Tn(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,i),i.Sa.push(t),t.va(n.onlineState),i.wa&&t.Fa(i.wa)&&go(n)}async function fo(e,t){const n=L(e),r=t.query;let s=3;const i=n.queries.get(r);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function po(e,t){const n=L(e);let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.Sa)t.Fa(e)&&(r=!0);s.wa=e}}r&&go(n)}function mo(e,t,n){const r=L(e),s=r.queries.get(t);if(s)for(const e of s.Sa)e.onError(n);r.queries.delete(t)}function go(e){e.Ca.forEach(e=>{e.next()})}var yo,vo;(vo=yo||(yo={})).Ma="default",vo.Cache="cache";class wo{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ao(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ao.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==yo.Cache}}class _o{constructor(e){this.key=e}}class Eo{constructor(e){this.key=e}}class Io{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Fn(),this.mutatedKeys=Fn(),this.eu=Cn(e),this.tu=new io(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new oo,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),h=Sn(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.eu(h,a)>0||c&&this.eu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{tu:i,iu:n,Cs:o,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=r??!1;const o=t&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,c=a!==this.Za;return this.Za=a,0!==i.length||c?{snapshot:new ao(this.query,e.tu,s,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Fn(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Eo(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new _o(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=Fn();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ao.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const bo="SyncEngine";class To{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class So{constructor(e){this.key=e,this.hu=!1}}class Co{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new An(e=>bn(e),In),this.Iu=new Map,this.Eu=new Set,this.du=new Ge(ie.comparator),this.Au=new Map,this.Ru=new Vs,this.Vu={},this.mu=new Map,this.fu=Ss.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function ko(e,t,n=!0){const r=Go(e);let s;const i=r.Tu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await No(r,t,n,!0),s}async function Ao(e,t){const n=Go(e);await No(n,t,!0,!1)}async function No(e,t,n,r){const s=await function(e,t){const n=L(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Pi.getTargetData(e,t).next(s=>s?(r=s,Te.resolve(r)):n.Pi.allocateTargetId(e).next(s=>(r=new gs(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,wn(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await async function(e,t,n,r,s){e.pu=(t,n,r)=>async function(e,t,n,r){let s=t.view.ru(n);s.Cs&&(s=await ri(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,s)));const i=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return jo(e,t.targetId,a.au),a.snapshot}(e,t,n,r);const i=await ri(e.localStore,t,!0),o=new Io(t,i.Qs),a=o.ru(i.documents),c=Pr.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);jo(e,n,u.au);const h=new To(t,n,o);return e.Tu.set(t,h),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&Di(e.remoteStore,s),a}async function Ro(e,t,n){const r=L(e),s=r.Tu.get(t),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(e=>!In(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ni(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Pi(r.remoteStore,s.targetId),Fo(r,s.targetId)}).catch(be)):(Fo(r,s.targetId),await ni(r.localStore,s.targetId,!0))}async function Do(e,t){const n=L(e),r=n.Tu.get(t),s=n.Iu.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Pi(n.remoteStore,r.targetId))}async function Po(e,t){const n=L(e);try{const e=await function(e,t){const n=L(e),r=t.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const o=[];t.targetChanges.forEach((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,i.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(et.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=Xs||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Pi.updateTargetData(e,u))});let a=Rn(),c=Fn();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){let r=Fn(),s=Fn();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Rn();return n.forEach((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(ye.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):k(Js,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)}),{ks:r,qs:s}})}(e,i,t.documentUpdates).next(e=>{a=e.ks,c=e.qs})),!r.isEqual(ye.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return Te.waitFor(o).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.Ms=s,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(O(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?O(r.hu,14607):e.removedDocuments.size>0&&(O(r.hu,42227),r.hu=!1))}),await zo(n,e,t)}catch(e){await be(e)}}function Oo(e,t,n){const r=L(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const s=r.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=L(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const e of n.Sa)e.va(t)&&(r=!0)}),r&&go(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Lo(e,t,n){const r=L(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Au.get(t),i=s&&s.key;if(i){let e=new Ge(ie.comparator);e=e.insert(i,Bt.newNoDocument(i,ye.min()));const n=Fn().add(i),s=new Dr(ye.min(),new Map,new Ge(W),e,n);await Po(r,s),r.du=r.du.remove(i),r.Au.delete(t),$o(r)}else await ni(r.localStore,t,!1).then(()=>Fo(r,t,n)).catch(be)}async function Mo(e,t){const n=L(e),r=t.batch.batchId;try{const e=await function(e,t){const n=L(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=Te.resolve();return i.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);O(null!==i,48541),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(n,e,t,s).next(()=>s.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Fn();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);Uo(n,r,null),Vo(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zo(n,e)}catch(e){await be(e)}}async function xo(e,t,n){const r=L(e);try{const e=await function(e,t){const n=L(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(O(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);Uo(r,t,n),Vo(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await zo(r,e)}catch(n){await be(n)}}function Vo(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Uo(e,t,n){const r=L(e);let s=r.Vu[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function Fo(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||Bo(e,t)})}function Bo(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(Pi(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),$o(e))}function jo(e,t,n){for(const r of n)r instanceof _o?(e.Ru.addReference(r.key,t),qo(e,r)):r instanceof Eo?(k(bo,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||Bo(e,r.key)):D(19791,{wu:r})}function qo(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(k(bo,"New document in limbo: "+n),e.Eu.add(r),$o(e))}function $o(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new ie(ne.fromString(t)),r=e.fu.next();e.Au.set(r,new So(n)),e.du=e.du.insert(n,r),Di(e.remoteStore,new gs(wn(mn(n.path)),r,"TargetPurposeLimboResolution",Ce.ce))}}async function zo(e,t,n){const r=L(e),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((e,a)=>{o.push(r.pu(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(a.targetId)?.current;r.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){s.push(e);const t=Gs.As(a.targetId,e);i.push(t)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(e,t){const n=L(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Te.forEach(t,t=>Te.forEach(t.Es,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Te.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Se(e))throw e;k(Js,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ms.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,s)}}}(r.localStore,i))}async function Ho(e,t){const n=L(e);if(!n.currentUser.isEqual(t)){k(bo,"User change. New user:",t.toKey());const e=await Zs(n.localStore,t);n.currentUser=t,function(e){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new x(M.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await zo(n,e.Ls)}}function Ko(e,t){const n=L(e),r=n.Au.get(t);if(r&&r.hu)return Fn().add(r.key);{let e=Fn();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Go(e){const t=L(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Po.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ko.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lo.bind(null,t),t.Pu.H_=po.bind(null,t.eventManager),t.Pu.yu=mo.bind(null,t.eventManager),t}function Wo(e){const t=L(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Mo.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=xo.bind(null,t),t}class Qo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=vi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,r){return new Ys(e,t,n,r)}(this.persistence,new Qs,e.initialUser,this.serializer)}Cu(e){return new $s(Hs.mi,this.serializer)}Du(e){return new ii}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Qo.provider={build:()=>new Qo};class Jo extends Qo{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){O(this.persistence.referenceDelegate instanceof Ks,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Ns(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Ts.withCacheSize(this.cacheSizeBytes):Ts.DEFAULT;return new $s(e=>Ks.mi(e,t),this.serializer)}}class Xo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Oo(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ho.bind(null,this.syncEngine),await async function(e,t){const n=L(e);t?(n.Ea.delete(2),await Ni(n)):t||(n.Ea.add(2),await Ri(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uo}createDatastore(e){const t=vi(e.databaseInfo.databaseId),n=function(e){return new gi(e)}(e.databaseInfo);return function(e,t,n,r){return new Si(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new Ai(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,e=>Oo(this.syncEngine,e,0),ci.v()?new ci:new oi)}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new Co(e,t,n,r,s,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=L(e);k(ki,"RemoteStore shutting down."),t.Ea.add(5),await Ri(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Xo.provider={build:()=>new Xo};class Yo{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):A("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Zo="FirestoreClient";class ea{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=b.UNAUTHENTICATED,this.clientId=G.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async e=>{k(Zo,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(k(Zo,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new V;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=so(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function ta(e,t){e.asyncQueue.verifyOperationInProgress(),k(Zo,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Zs(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function na(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){k(Zo,"Using user provided OfflineComponentProvider");try{await ta(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===M.FAILED_PRECONDITION||e.code===M.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;N("Error using user provided cache. Falling back to memory cache: "+n),await ta(e,new Qo)}}else k(Zo,"Using default OfflineComponentProvider"),await ta(e,new Jo(void 0));return e._offlineComponents}(e);k(Zo,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>eo(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>eo(t.remoteStore,n)),e._onlineComponents=t}async function ra(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(k(Zo,"Using user provided OnlineComponentProvider"),await na(e,e._uninitializedComponentsProvider._online)):(k(Zo,"Using default OnlineComponentProvider"),await na(e,new Xo))),e._onlineComponents}async function sa(e){const t=await ra(e),n=t.eventManager;return n.onListen=ko.bind(null,t.syncEngine),n.onUnlisten=Ro.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Ao.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Do.bind(null,t.syncEngine),n}function ia(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const oa=new Map,aa="firestore.googleapis.com",ca=!0;class ua{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new x(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=aa,this.ssl=ca}else this.host=e.host,this.ssl=e.ssl??ca;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=bs;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new x(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new x(M.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ia(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new x(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new x(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new x(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ha{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ua({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new x(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ua(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new F;switch(e.type){case"firstParty":return new $(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new x(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=oa.get(e);t&&(k("ComponentProvider","Removing Datastore"),oa.delete(e),t.terminate())}(this),Promise.resolve()}}class la{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new la(this.firestore,e,this._query)}}class da{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fa(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new da(this.firestore,e,this._key)}toJSON(){return{type:da._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(fe(t,da._jsonSchema))return new da(e,n||null,new ie(ne.fromString(t.referencePath)))}}da._jsonSchemaVersion="firestore/documentReference/1.0",da._jsonSchema={type:de("string",da._jsonSchemaVersion),referencePath:de("string")};class fa extends la{constructor(e,t,n){super(e,t,mn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new da(this.firestore,null,new ie(e))}withConverter(e){return new fa(this.firestore,e,this._path)}}function pa(e,t,...n){if(e=(0,c.Ku)(e),oe("collection","path",t),e instanceof ha){const r=ne.fromString(t,...n);return ce(r),new fa(e,null,r)}{if(!(e instanceof da||e instanceof fa))throw new x(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ne.fromString(t,...n));return ce(r),new fa(e.firestore,null,r)}}function ma(e,t,...n){if(e=(0,c.Ku)(e),1===arguments.length&&(t=G.newId()),oe("doc","path",t),e instanceof ha){const r=ne.fromString(t,...n);return ae(r),new da(e,null,new ie(r))}{if(!(e instanceof da||e instanceof fa))throw new x(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ne.fromString(t,...n));return ae(r),new da(e.firestore,e instanceof fa?e.converter:null,new ie(r))}}const ga="AsyncQueue";class ya{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new wi(this,"async_queue_retry"),this._c=()=>{const e=yi();e&&k(ga,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=yi();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=yi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new V;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Se(e))throw e;k(ga,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,A("INTERNAL UNHANDLED ERROR: ",va(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=ro.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&D(47125,{Pc:va(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function va(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function wa(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(e)}class _a extends ha{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ya,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ya(e),this._firestoreClient=void 0,await e}}}function Ea(e,t){const n="object"==typeof e?e:(0,i.Sx)(),r="string"==typeof e?e:t||ft,s=(0,i.j6)(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=(0,c.yU)("firestore");e&&function(e,t,n,r={}){e=le(e,ha);const s=(0,c.zJ)(t),i=e._getSettings(),o={...i,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;s&&((0,c.gE)(`https://${a}`),(0,c.P1)("Firestore",!0)),i.host!==aa&&i.host!==a&&N("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:a,ssl:s,emulatorOptions:r};if(!(0,c.bD)(u,o)&&(e._setSettings(u),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=b.MOCK_USER;else{t=(0,c.Fy)(r.mockUserToken,e._app?.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new x(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new b(s)}e._authCredentials=new B(new U(t,n))}}(s,...e)}return s}function Ia(e){if(e._terminated)throw new x(M.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){const t=e._freezeSettings(),n=function(e,t,n,r){return new dt(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,ia(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new ea(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class ba{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ba(et.fromBase64String(e))}catch(e){throw new x(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ba(et.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ba._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(fe(e,ba._jsonSchema))return ba.fromBase64String(e.bytes)}}ba._jsonSchemaVersion="firestore/bytes/1.0",ba._jsonSchema={type:de("string",ba._jsonSchemaVersion),bytes:de("string")};class Ta{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new x(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Sa{constructor(e){this._methodName=e}}class Ca{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ca._jsonSchemaVersion}}static fromJSON(e){if(fe(e,Ca._jsonSchema))return new Ca(e.latitude,e.longitude)}}Ca._jsonSchemaVersion="firestore/geoPoint/1.0",Ca._jsonSchema={type:de("string",Ca._jsonSchemaVersion),latitude:de("number"),longitude:de("number")};class ka{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ka._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(fe(e,ka._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new ka(e.vectorValues);throw new x(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ka._jsonSchemaVersion="firestore/vectorValue/1.0",ka._jsonSchema={type:de("string",ka._jsonSchemaVersion),vectorValues:de("object")};const Aa=/^__.*__$/;class Na{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new fr(e,this.data,this.fieldMask,t,this.fieldTransforms):new dr(e,this.data,t,this.fieldTransforms)}}class Ra{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new fr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Da(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D(40011,{Ac:e})}}class Pa{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Pa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ha(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Da(this.Ac)&&Aa.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Oa{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||vi(e)}Cc(e,t,n,r=!1){return new Pa({Ac:e,methodName:t,Dc:n,path:se.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function La(e){const t=e._freezeSettings(),n=vi(e._databaseId);return new Oa(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Ma(e,t,n,r,s,i={}){const o=e.Cc(i.merge||i.mergeFields?2:0,t,n,s);ja("Data must be an object, but it was:",o,r);const a=Fa(r,o);let c,u;if(i.merge)c=new Ye(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=qa(t,r,n);if(!o.contains(s))throw new x(M.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Ka(e,s)||e.push(s)}c=new Ye(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new Na(new Ut(a),c,u)}class xa extends Sa{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xa}}class Va extends Sa{_toFieldTransform(e){return new nr(e.path,new Wn)}isEqual(e){return e instanceof Va}}function Ua(e,t){if(Ba(e=(0,c.Ku)(e)))return ja("Unsupported field value:",t,e),Fa(e,t);if(e instanceof Sa)return function(e,t){if(!Da(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Ua(s,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return $n(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ge.fromDate(e);return{timestampValue:Hr(t.serializer,n)}}if(e instanceof ge){const n=new ge(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Hr(t.serializer,n)}}if(e instanceof Ca)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ba)return{bytesValue:Kr(t.serializer,e._byteString)};if(e instanceof da){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Qr(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ka)return function(e,t){return{mapValue:{fields:{[mt]:{stringValue:vt},[wt]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return jn(t.serializer,e)})}}}}}}(e,t);throw t.Sc(`Unsupported field value: ${he(e)}`)}(e,t)}function Fa(e,t){const n={};return Ke(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):He(e,(e,r)=>{const s=Ua(r,t.mc(e));null!=s&&(n[e]=s)}),{mapValue:{fields:n}}}function Ba(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ge||e instanceof Ca||e instanceof ba||e instanceof da||e instanceof Sa||e instanceof ka)}function ja(e,t,n){if(!Ba(n)||!ue(n)){const r=he(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function qa(e,t,n){if((t=(0,c.Ku)(t))instanceof Ta)return t._internalPath;if("string"==typeof t)return za(e,t);throw Ha("Field path arguments must be of type string or ",e,!1,void 0,n)}const $a=new RegExp("[~\\*/\\[\\]]");function za(e,t,n){if(t.search($a)>=0)throw Ha(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ta(...t.split("."))._internalPath}catch(r){throw Ha(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Ha(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new x(M.INVALID_ARGUMENT,a+e+c)}function Ka(e,t){return e.some(e=>e.isEqual(t))}class Ga{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new da(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Wa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Qa("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Wa extends Ga{data(){return super.data()}}function Qa(e,t){return"string"==typeof t?za(e,t):t instanceof Ta?t._internalPath:t._delegate._internalPath}function Ja(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new x(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xa{}class Ya extends Xa{}function Za(e,t,...n){let r=[];t instanceof Xa&&r.push(t),r=r.concat(n),function(e){const t=e.filter(e=>e instanceof nc).length,n=e.filter(e=>e instanceof ec).length;if(t>1||t>0&&n>0)throw new x(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class ec extends Ya{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ec(e,t,n)}_apply(e){const t=this._parse(e);return ac(e._query,t),new la(e.firestore,e.converter,_n(e._query,t))}_parse(e){const t=La(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new x(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){oc(o,i);const t=[];for(const n of o)t.push(ic(r,e,n));a={arrayValue:{values:t}}}else a=ic(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||oc(o,i),a=function(e,t,n,r=!1){return Ua(n,e.Cc(r?4:3,t))}(n,"where",o,"in"===i||"not-in"===i);return Gt.create(s,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function tc(e,t,n){const r=t,s=Qa("where",e);return ec._create(s,r,n)}class nc extends Xa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new nc(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Wt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)ac(n,e),n=_n(n,e)}(e._query,t),new la(e.firestore,e.converter,_n(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class rc extends Ya{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new rc(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new x(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new x(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zt(t,n)}(e._query,this._field,this._direction);return new la(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new pn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function sc(e,t="asc"){const n=t,r=Qa("orderBy",e);return rc._create(r,n)}function ic(e,t,n){if("string"==typeof(n=(0,c.Ku)(n))){if(""===n)throw new x(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yn(t)&&-1!==n.indexOf("/"))throw new x(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ne.fromString(n));if(!ie.isDocumentKey(r))throw new x(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Nt(e,new ie(r))}if(n instanceof da)return Nt(e,n._key);throw new x(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${he(n)}.`)}function oc(e,t){if(!Array.isArray(e)||0===e.length)throw new x(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ac(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new x(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class cc{convertValue(e,t="none"){switch(_t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(st(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw D(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return He(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){const t=e.fields?.[wt].arrayValue?.values?.map(e=>rt(e.doubleValue));return new ka(t)}convertGeoPoint(e){return new Ca(rt(e.latitude),rt(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ht(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(lt(e));default:return null}}convertTimestamp(e){const t=nt(e);return new ge(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ne.fromString(e);O(ms(n),9688,{name:e});const r=new pt(n.get(1),n.get(3)),s=new ie(n.popFirst(5));return r.isEqual(t)||A(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function uc(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class hc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class lc extends Ga{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Qa("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=lc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}lc._jsonSchemaVersion="firestore/documentSnapshot/1.0",lc._jsonSchema={type:de("string",lc._jsonSchemaVersion),bundleSource:de("string","DocumentSnapshot"),bundleName:de("string"),bundle:de("string")};class dc extends lc{data(e={}){return super.data(e)}}class fc{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hc(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new dc(this._firestore,this._userDataWriter,n.key,n,new hc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new dc(e._firestore,e._userDataWriter,n.doc.key,n.doc,new hc(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new dc(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hc(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:pc(t.type),doc:r,oldIndex:s,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=fc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=G.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function pc(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D(61501,{type:e})}}function mc(e){e=le(e,da);const t=le(e.firestore,_a);return function(e,t,n={}){const r=new V;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,s){const i=new Yo({next:a=>{i.Nu(),t.enqueueAndForget(()=>fo(e,o));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new x(M.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new x(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new wo(mn(n.path),i,{includeMetadataChanges:!0,qa:!0});return lo(e,o)}(await sa(e),e.asyncQueue,t,n,r)),r.promise}(Ia(t),e._key).then(n=>Tc(t,e,n))}fc._jsonSchemaVersion="firestore/querySnapshot/1.0",fc._jsonSchema={type:de("string",fc._jsonSchemaVersion),bundleSource:de("string","QuerySnapshot"),bundleName:de("string"),bundle:de("string")};class gc extends cc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ba(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new da(this.firestore,null,t)}}function yc(e){e=le(e,la);const t=le(e.firestore,_a),n=Ia(t),r=new gc(t);return Ja(e._query),function(e,t,n={}){const r=new V;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,s){const i=new Yo({next:n=>{i.Nu(),t.enqueueAndForget(()=>fo(e,o)),n.fromCache&&"server"===r.source?s.reject(new x(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new wo(n,i,{includeMetadataChanges:!0,qa:!0});return lo(e,o)}(await sa(e),e.asyncQueue,t,n,r)),r.promise}(n,e._query).then(n=>new fc(t,r,e,n))}function vc(e,t,n){e=le(e,da);const r=le(e.firestore,_a),s=uc(e.converter,t,n);return bc(r,[Ma(La(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,sr.none())])}function wc(e,t,n,...r){e=le(e,da);const s=le(e.firestore,_a),i=La(s);let o;return o="string"==typeof(t=(0,c.Ku)(t))||t instanceof Ta?function(e,t,n,r,s,i){const o=e.Cc(1,t,n),a=[qa(t,r,n)],u=[s];if(i.length%2!=0)throw new x(M.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(qa(t,i[e])),u.push(i[e+1]);const h=[],l=Ut.empty();for(let e=a.length-1;e>=0;--e)if(!Ka(h,a[e])){const t=a[e];let n=u[e];n=(0,c.Ku)(n);const r=o.yc(t);if(n instanceof xa)h.push(t);else{const e=Ua(n,r);null!=e&&(h.push(t),l.set(t,e))}}const d=new Ye(h);return new Ra(l,d,o.fieldTransforms)}(i,"updateDoc",e._key,t,n,r):function(e,t,n,r){const s=e.Cc(1,t,n);ja("Data must be an object, but it was:",s,r);const i=[],o=Ut.empty();He(r,(e,r)=>{const a=za(t,e,n);r=(0,c.Ku)(r);const u=s.yc(a);if(r instanceof xa)i.push(a);else{const e=Ua(r,u);null!=e&&(i.push(a),o.set(a,e))}});const a=new Ye(i);return new Ra(o,a,s.fieldTransforms)}(i,"updateDoc",e._key,t),bc(s,[o.toMutation(e._key,sr.exists(!0))])}function _c(e){return bc(le(e.firestore,_a),[new yr(e._key,sr.none())])}function Ec(e,t){const n=le(e.firestore,_a),r=ma(e),s=uc(e.converter,t);return bc(n,[Ma(La(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,sr.exists(!1))]).then(()=>r)}function Ic(e,...t){e=(0,c.Ku)(e);let n={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof t[r]||wa(t[r])||(n=t[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(wa(t[r])){const e=t[r];t[r]=e.next?.bind(e),t[r+1]=e.error?.bind(e),t[r+2]=e.complete?.bind(e)}let i,o,a;if(e instanceof da)o=le(e.firestore,_a),a=mn(e._key.path),i={next:n=>{t[r]&&t[r](Tc(o,e,n))},error:t[r+1],complete:t[r+2]};else{const n=le(e,la);o=le(n.firestore,_a),a=n._query;const s=new gc(o);i={next:e=>{t[r]&&t[r](new fc(o,s,n,e))},error:t[r+1],complete:t[r+2]},Ja(e._query)}return function(e,t,n,r){const s=new Yo(r),i=new wo(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>lo(await sa(e),i)),()=>{s.Nu(),e.asyncQueue.enqueueAndForget(async()=>fo(await sa(e),i))}}(Ia(o),a,s,i)}function bc(e,t){return function(e,t){const n=new V;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=Wo(e);try{const e=await function(e,t){const n=L(e),r=ge.now(),s=t.reduce((e,t)=>e.add(t.key),Fn());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Rn(),c=Fn();return n.Ns.getEntries(e,s).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(s=>{i=s;const o=[];for(const e of t){const t=hr(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new fr(e.key,t,Ft(t.value.mapValue),sr.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:On(i)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||(r=new Ge(W)),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,n),await zo(r,e.changes),await Hi(r.remoteStore)}catch(e){const t=so(e,"Failed to persist write");n.reject(t)}}(await function(e){return ra(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(Ia(e),t)}function Tc(e,t,n){const r=n.docs.get(t._key),s=new gc(e);return new lc(e,s,t._key,r,new hc(n.hasPendingWrites,n.fromCache),t.converter)}function Sc(){return new xa("deleteField")}function Cc(){return new Va("serverTimestamp")}new WeakMap,function(e,t=!0){!function(e){T=e}(i.MF),(0,i.om)(new o.uA("firestore",(e,{instanceIdentifier:n,options:r})=>{const s=e.getProvider("app").getImmediate(),i=new _a(new j(e.getProvider("auth-internal")),new H(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new x(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pt(e.options.projectId,t)}(s,n),s);return r={useFetchStreams:t,...r},i._setSettings(r),i},"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(E,I,e),(0,i.KO)(E,I,"esm2020")}()},711:(e,t,n)=>{n.d(t,{h1:()=>a,uA:()=>s});var r=n(47);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const i="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=i){return this.instances.has(e)}getOptions(e=i){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const s=this.instances.get(n);return s&&e(s,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===i?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=i){return this.component?this.component.multipleInstances?e:i:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},722:(e,t,n)=>{n.d(t,{$b:()=>s,Vy:()=>u});const r=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),s=a[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}},726:(e,t,n)=>{n.d(t,{eJ:()=>et,hG:()=>it,xI:()=>yn,hg:()=>rt,x9:()=>tt,CI:()=>st,r7:()=>nt});var r=n(0),s=n(47),i=n(722),o=n(711);const a=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},c=new s.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),u=new i.Vy("@firebase/auth");function h(e,...t){u.logLevel<=i.$b.ERROR&&u.error(`Auth (${r.MF}): ${e}`,...t)}function l(e,...t){throw m(e,...t)}function d(e,...t){return m(e,...t)}function f(e,t,n){const r={...a(),[t]:n};return new s.FA("auth","Firebase",r).create(t,{appName:e.name})}function p(e){return f(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function m(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return c.create(e,...t)}function g(e,t,...n){if(!e)throw m(t,...n)}function y(e){const t="INTERNAL ASSERTION FAILED: "+e;throw h(t),new Error(t)}function v(e,t){e||y(t)}function w(){return"undefined"!=typeof self&&self.location?.href||""}function _(){return"undefined"!=typeof self&&self.location?.protocol||null}class E{constructor(e,t){this.shortDelay=e,this.longDelay=t,v(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,s.jZ)()||(0,s.lV)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===_()||"https:"===_()||(0,s.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function I(e,t){v(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class b{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void y("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void y("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void y("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const T={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},S=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],C=new E(3e4,6e4);function k(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function A(e,t,n,r,i={}){return N(e,i,async()=>{let i={},o={};r&&("GET"===t?o=r:i={body:JSON.stringify(r)});const a=(0,s.Am)({key:e.config.apiKey,...o}).slice(1),c=await e._getAdditionalHeaders();c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode);const u={method:t,headers:c,...i};return(0,s.c1)()||(u.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,s.zJ)(e.emulatorConfig.host)&&(u.credentials="include"),b.fetch()(await D(e,e.config.apiHost,n,a),u)})}async function N(e,t,n){e._canInitEmulator=!1;const r={...T,...t};try{const t=new O(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw L(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw L(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw L(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw L(e,"user-disabled",i);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw f(e,a,o);l(e,a)}}catch(t){if(t instanceof s.g)throw t;l(e,"network-request-failed",{message:String(t)})}}async function R(e,t,n,r,s={}){const i=await A(e,t,n,r,s);return"mfaPendingCredential"in i&&l(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function D(e,t,n,r){const s=`${t}${n}?${r}`,i=e,o=i.config.emulator?I(e.config,s):`${e.config.apiScheme}://${s}`;return S.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(o).toString():o}function P(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class O{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(d(this.auth,"network-request-failed")),C.get())})}}function L(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=d(e,t,r);return s.customData._tokenResponse=n,s}function M(e){return void 0!==e&&void 0!==e.enterprise}class x{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return P(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function V(e,t){return A(e,"GET","/v2/recaptchaConfig",k(e,t))}async function U(e,t){return A(e,"POST","/v1/accounts:lookup",t)}function F(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function B(e){return 1e3*Number(e)}function j(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return h("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,s.u)(n);return e?JSON.parse(e):(h("Failed to decode base64 JWT payload"),null)}catch(e){return h("Caught error parsing JWT payload as JSON",e?.toString()),null}}function q(e){const t=j(e);return g(t,"internal-error"),g(void 0!==t.exp,"internal-error"),g(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function $(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof s.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class z{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class H{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=F(this.lastLoginAt),this.creationTime=F(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function K(e){const t=e.auth,n=await e.getIdToken(),r=await $(e,U(t,{idToken:n}));g(r?.users.length,t,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const i=s.providerUserInfo?.length?G(s.providerUserInfo):[],o=(a=e.providerData,c=i,[...a.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var a,c;const u=e.isAnonymous,h=!(e.email&&s.passwordHash||o?.length),l=!!u&&h,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new H(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,d)}function G(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}class W{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){g(e.idToken,"internal-error"),g(void 0!==e.idToken,"internal-error"),g(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):q(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){g(0!==e.length,"internal-error");const t=q(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(g(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await N(e,{},async()=>{const n=(0,s.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,o=await D(e,r,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:n};return e.emulatorConfig&&(0,s.zJ)(e.emulatorConfig.host)&&(c.credentials="include"),b.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new W;return n&&(g("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(g("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(g("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new W,this.toJSON())}_performRefresh(){return y("not implemented")}}function Q(e,t){g("string"==typeof e||void 0===e,"internal-error",{appName:t})}class J{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new z(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new H(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await $(this,this.stsTokenManager.getToken(this.auth,e));return g(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,s.Ku)(e),r=await n.getIdToken(t),i=j(r);g(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o="object"==typeof i.firebase?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:F(B(i.auth_time)),issuedAtTime:F(B(i.iat)),expirationTime:F(B(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=(0,s.Ku)(e);await K(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(g(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new J({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await K(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,r.xZ)(this.auth.app))return Promise.reject(p(this.auth));const e=await this.getIdToken();return await $(this,async function(e,t){return A(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,i=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:l,isAnonymous:d,providerData:f,stsTokenManager:p}=t;g(h&&p,e,"internal-error");const m=W.fromJSON(this.name,p);g("string"==typeof h,e,"internal-error"),Q(n,e.name),Q(r,e.name),g("boolean"==typeof l,e,"internal-error"),g("boolean"==typeof d,e,"internal-error"),Q(s,e.name),Q(i,e.name),Q(o,e.name),Q(a,e.name),Q(c,e.name),Q(u,e.name);const y=new J({uid:h,auth:e,email:r,emailVerified:l,displayName:n,isAnonymous:d,photoURL:i,phoneNumber:s,tenantId:o,stsTokenManager:m,createdAt:c,lastLoginAt:u});return f&&Array.isArray(f)&&(y.providerData=f.map(e=>({...e}))),a&&(y._redirectEventId=a),y}static async _fromIdTokenResponse(e,t,n=!1){const r=new W;r.updateFromServerResponse(t);const s=new J({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await K(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];g(void 0!==r.localId,"internal-error");const s=void 0!==r.providerUserInfo?G(r.providerUserInfo):[],i=!(r.email&&r.passwordHash||s?.length),o=new W;o.updateFromIdToken(n);const a=new J({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new H(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||s?.length)};return Object.assign(a,c),a}}const X=new Map;function Y(e){v(e instanceof Function,"Expected a class definition");let t=X.get(e);return t?(v(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,X.set(e,t),t)}class Z{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Z.type="NONE";const ee=Z;function te(e,t,n){return`firebase:${e}:${t}:${n}`}class ne{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=te(this.userKey,r.apiKey,s),this.fullPersistenceKey=te("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await U(this.auth,{idToken:e}).catch(()=>{});return t?J._fromGetAccountInfoResponse(this.auth,t,e):null}return J._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ne(Y(ee),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=r[0]||Y(ee);const i=te(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(i);if(t){let r;if("string"==typeof t){const n=await U(e,{idToken:t}).catch(()=>{});if(!n)break;r=await J._fromGetAccountInfoResponse(e,n,t)}else r=J._fromJSON(e,t);n!==s&&(o=r),s=n;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch{}})),new ne(s,e,n)):new ne(s,e,n)}}function re(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ae(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(se(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ue(t))return"Blackberry";if(he(t))return"Webos";if(ie(t))return"Safari";if((t.includes("chrome/")||oe(t))&&!t.includes("edge/"))return"Chrome";if(ce(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function se(e=(0,s.ZQ)()){return/firefox\//i.test(e)}function ie(e=(0,s.ZQ)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function oe(e=(0,s.ZQ)()){return/crios\//i.test(e)}function ae(e=(0,s.ZQ)()){return/iemobile/i.test(e)}function ce(e=(0,s.ZQ)()){return/android/i.test(e)}function ue(e=(0,s.ZQ)()){return/blackberry/i.test(e)}function he(e=(0,s.ZQ)()){return/webos/i.test(e)}function le(e=(0,s.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function de(e=(0,s.ZQ)()){return le(e)||ce(e)||he(e)||ue(e)||/windows phone/i.test(e)||ae(e)}function fe(e,t=[]){let n;switch(e){case"Browser":n=re((0,s.ZQ)());break;case"Worker":n=`${re((0,s.ZQ)())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.MF}/${i}`}class pe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}class me{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class ge{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ve(this),this.idTokenSubscription=new ve(this),this.beforeStateQueue=new pe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Y(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ne.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await U(this,{idToken:e}),n=await J._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,r.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,i=await this.tryRedirectSignIn(e);t&&t!==r||!i?.user||(n=i.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await K(e)}catch(e){if("auth/network-request-failed"!==e?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,r.xZ)(this.app))return Promise.reject(p(this));const t=e?(0,s.Ku)(e):null;return t&&g(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&g(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,r.xZ)(this.app)?Promise.reject(p(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,r.xZ)(this.app)?Promise.reject(p(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Y(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return A(e,"GET","/v2/passwordPolicy",k(e,t))}(this),t=new me(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new s.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return A(e,"POST","/v2/accounts:revokeToken",k(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Y(e)||this._popupRedirectResolver;g(t,this,"argument-error"),this.redirectPersistenceManager=await ne.create(this,[Y(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(g(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),"function"==typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fe(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if((0,r.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){u.logLevel<=i.$b.WARN&&u.warn(`Auth (${r.MF}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ye(e){return(0,s.Ku)(e)}class ve{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,s.tD)(e=>this.observer=e)}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let we={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _e(e){return we.loadJS(e)}function Ee(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ie{constructor(){this.enterprise=new be}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class be{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Te="NO_RECAPTCHA";class Se{constructor(e){this.type="recaptcha-enterprise",this.auth=ye(e)}async verify(e="verify",t=!1){function n(t,n,r){const s=window.grecaptcha;M(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Te)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Ie).execute("siteKey",{action:"verify"}):new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{V(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new x(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&M(window.grecaptcha))n(s,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=we.recaptchaEnterpriseScript;0!==t.length&&(t+=s),_e(t).then(()=>{n(s,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Ce(e,t,n,r=!1,s=!1){const i=new Se(e);let o;if(s)o=Te;else try{o=await i.verify(n)}catch(e){o=await i.verify(n,!0)}const a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ke(e,t,n,r,s){if("EMAIL_PASSWORD_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Ce(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Ce(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const s=await Ce(e,t,n);return r(e,s).catch(async s=>{if("AUDIT"===e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const s=await Ce(e,t,n,!1,!0);return r(e,s)}return Promise.reject(s)})}{const s=await Ce(e,t,n,!1,!0);return r(e,s)}}return Promise.reject(s+" provider is not supported.")}function Ae(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ne(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Re{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return y("not implemented")}_getIdTokenResponse(e){return y("not implemented")}_linkToIdToken(e,t){return y("not implemented")}_getReauthenticationResolver(e){return y("not implemented")}}async function De(e,t){return A(e,"POST","/v1/accounts:signUp",t)}async function Pe(e,t){return R(e,"POST","/v1/accounts:signInWithPassword",k(e,t))}class Oe extends Re{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Oe(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Oe(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ke(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Pe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithEmailLink",k(e,t))}(e,{email:this._email,oobCode:this._password});default:l(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ke(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",De,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithEmailLink",k(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:l(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Le(e,t){return R(e,"POST","/v1/accounts:signInWithIdp",k(e,t))}class Me extends Re{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Me(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):l("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,...s}=t;if(!n||!r)return null;const i=new Me(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Le(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Le(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Le(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,s.Am)(t)}return e}}async function xe(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",k(e,t))}const Ve={USER_NOT_FOUND:"user-not-found"};class Ue extends Re{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ue({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ue({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPhoneNumber",k(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await R(e,"POST","/v1/accounts:signInWithPhoneNumber",k(e,t));if(n.temporaryProof)throw L(e,"account-exists-with-different-credential",n);return n}(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPhoneNumber",k(e,{...t,operation:"REAUTH"}),Ve)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new Ue({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class Fe{constructor(e){const t=(0,s.I9)((0,s.hp)(e)),n=t.apiKey??null,r=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);g(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=(0,s.I9)((0,s.hp)(e)).link,n=t?(0,s.I9)((0,s.hp)(t)).deep_link_id:null,r=(0,s.I9)((0,s.hp)(e)).deep_link_id;return(r?(0,s.I9)((0,s.hp)(r)).link:null)||r||n||t||e}(e);try{return new Fe(t)}catch{return null}}}class Be{constructor(){this.providerId=Be.PROVIDER_ID}static credential(e,t){return Oe._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Fe.parseLink(t);return g(n,"argument-error"),Oe._fromEmailAndCode(e,n.code,n.tenantId)}}Be.PROVIDER_ID="password",Be.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Be.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class je{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qe extends je{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class $e extends qe{constructor(){super("facebook.com")}static credential(e){return Me._fromParams({providerId:$e.PROVIDER_ID,signInMethod:$e.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $e.credentialFromTaggedObject(e)}static credentialFromError(e){return $e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return $e.credential(e.oauthAccessToken)}catch{return null}}}$e.FACEBOOK_SIGN_IN_METHOD="facebook.com",$e.PROVIDER_ID="facebook.com";class ze extends qe{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Me._fromParams({providerId:ze.PROVIDER_ID,signInMethod:ze.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ze.credentialFromTaggedObject(e)}static credentialFromError(e){return ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ze.credential(t,n)}catch{return null}}}ze.GOOGLE_SIGN_IN_METHOD="google.com",ze.PROVIDER_ID="google.com";class He extends qe{constructor(){super("github.com")}static credential(e){return Me._fromParams({providerId:He.PROVIDER_ID,signInMethod:He.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return He.credentialFromTaggedObject(e)}static credentialFromError(e){return He.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return He.credential(e.oauthAccessToken)}catch{return null}}}He.GITHUB_SIGN_IN_METHOD="github.com",He.PROVIDER_ID="github.com";class Ke extends qe{constructor(){super("twitter.com")}static credential(e,t){return Me._fromParams({providerId:Ke.PROVIDER_ID,signInMethod:Ke.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ke.credentialFromTaggedObject(e)}static credentialFromError(e){return Ke.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ke.credential(t,n)}catch{return null}}}async function Ge(e,t){return R(e,"POST","/v1/accounts:signUp",k(e,t))}Ke.TWITTER_SIGN_IN_METHOD="twitter.com",Ke.PROVIDER_ID="twitter.com";class We{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await J._fromIdTokenResponse(e,n,r),i=Qe(n);return new We({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Qe(n);return new We({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Qe(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Je extends s.g{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Je.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Je(e,t,n,r)}}function Xe(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Je._fromErrorAndOperation(e,n,t,r);throw n})}async function Ye(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(p(e));const s="signIn",i=await Xe(e,s,t),o=await We._fromIdTokenResponse(e,s,i);return n||await e._updateCurrentUser(o.user),o}async function Ze(e){const t=ye(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function et(e,t,n){if((0,r.xZ)(e.app))return Promise.reject(p(e));const s=ye(e),i=ke(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ge,"EMAIL_PASSWORD_PROVIDER"),o=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Ze(e),t}),a=await We._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function tt(e,t,n){return(0,r.xZ)(e.app)?Promise.reject(p(e)):async function(e,t){return Ye(ye(e),t)}((0,s.Ku)(e),Be.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Ze(e),t})}async function nt(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=(0,s.Ku)(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await $(r,async function(e,t){return A(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function rt(e,t,n,r){return(0,s.Ku)(e).onAuthStateChanged(t,n,r)}function st(e){return(0,s.Ku)(e).signOut()}async function it(e){return(0,s.Ku)(e).delete()}function ot(e,t){return A(e,"POST","/v2/accounts/mfaEnrollment:start",k(e,t))}new WeakMap;const at="__sak";class ct{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(at,"1"),this.storage.removeItem(at),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ut extends ct{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=de(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);(0,s.lT)()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ut.type="LOCAL";const ht=ut;class lt extends ct{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}lt.type="SESSION";const dt=lt;class ft{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new ft(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(!i?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function pt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ft.receivers=[];class mt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise((o,a)=>{const c=pt("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function gt(){return window}function yt(){return void 0!==gt().WorkerGlobalScope&&"function"==typeof gt().importScripts}const vt="firebaseLocalStorageDb",wt="firebaseLocalStorage",_t="fbase_key";class Et{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function It(e,t){return e.transaction([wt],t?"readwrite":"readonly").objectStore(wt)}function bt(){const e=indexedDB.open(vt,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(wt,{keyPath:_t})}catch(e){n(e)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(wt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(vt);return new Et(e).toPromise()}(),t(await bt()))})})}async function Tt(e,t,n){const r=It(e,!0).put({[_t]:t,value:n});return new Et(r).toPromise()}function St(e,t){const n=It(e,!0).delete(t);return new Et(n).toPromise()}class Ct{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await bt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ft._getInstance(yt()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new mt(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await bt();return await Tt(e,at,"1"),await St(e,at),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Tt(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=It(e,!1).get(t),r=await new Et(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>St(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=It(e,!1).getAll();return new Et(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ct.type="LOCAL";const kt=Ct;function At(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:start",k(e,t))}Ee("rcb"),new E(3e4,6e4);const Nt="recaptcha";async function Rt(e,t,n){if(!e._getRecaptchaConfig())try{await async function(e){const t=ye(e),n=await V(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new x(n);null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new Se(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){g("enroll"===t.type,e,"internal-error");const s=ke(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===Te?(g(n?.type===Nt,e,"argument-error"),ot(e,await Dt(e,t,n))):ot(e,t),"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{g("signin"===t.type,e,"internal-error");const s=r.multiFactorHint?.uid||r.multiFactorUid;g(s,e,"missing-multi-factor-info");const i=ke(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===Te?(g(n?.type===Nt,e,"argument-error"),At(e,await Dt(e,t,n))):At(e,t),"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t=ke(e,{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===Te?(g(n?.type===Nt,e,"argument-error"),xe(e,await Dt(e,t,n))):xe(e,t),"PHONE_PROVIDER");return(await t.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function Dt(e,t,n){g(n.type===Nt,e,"argument-error");const r=await n.verify();g("string"==typeof r,e,"argument-error");const s={...t};if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:r}),s}class Pt{constructor(e){this.providerId=Pt.PROVIDER_ID,this.auth=ye(e)}verifyPhoneNumber(e,t){return Rt(this.auth,e,(0,s.Ku)(t))}static credential(e,t){return Ue._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Pt.credentialFromTaggedObject(t)}static credentialFromError(e){return Pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ue._fromTokenResponse(t,n):null}}Pt.PROVIDER_ID="phone",Pt.PHONE_SIGN_IN_METHOD="phone";class Ot extends Re{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Le(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Le(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Le(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Lt(e){return Ye(e.auth,new Ot(e),e.bypassAuthState)}function Mt(e){const{auth:t,user:n}=e;return g(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if((0,r.xZ)(s.app))return Promise.reject(p(s));const i="reauthenticate";try{const r=await $(e,Xe(s,i,t,e),n);g(r.idToken,s,"internal-error");const o=j(r.idToken);g(o,s,"internal-error");const{sub:a}=o;return g(e.uid===a,s,"user-mismatch"),We._forOperation(e,i,r)}catch(e){throw"auth/user-not-found"===e?.code&&l(s,"user-mismatch"),e}}(n,new Ot(e),e.bypassAuthState)}async function xt(e){const{auth:t,user:n}=e;return g(n,t,"internal-error"),async function(e,t,n=!1){const r=await $(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return We._forOperation(e,"link",r)}(n,new Ot(e),e.bypassAuthState)}class Vt{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Lt;case"linkViaPopup":case"linkViaRedirect":return xt;case"reauthViaPopup":case"reauthViaRedirect":return Mt;default:l(this.auth,"internal-error")}}resolve(e){v(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){v(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ut=new E(2e3,1e4);class Ft extends Vt{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,Ft.currentPopupAction&&Ft.currentPopupAction.cancel(),Ft.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return g(e,this.auth,"internal-error"),e}async onExecution(){v(1===this.filter.length,"Popup operations only handle one event");const e=pt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(d(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(d(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ft.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(d(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Ut.get())};e()}}Ft.currentPopupAction=null;const Bt=new Map;class jt extends Vt{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Bt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return te("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return Y(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Bt.set(this.auth._key(),e)}return this.bypassAuthState||Bt.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function qt(e,t){Bt.set(e._key(),t)}async function $t(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(p(e));const s=ye(e),i=function(e,t){return t?Y(t):(g(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(s,t),o=new jt(s,i,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class zt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Kt(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Kt(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(d(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ht(e))}saveEventToCache(e){this.cachedEventUids.add(Ht(e)),this.lastProcessedEventTime=Date.now()}}function Ht(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Kt({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}const Gt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Wt=/^https?/;function Qt(e){const t=w(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!Wt.test(n))return!1;if(Gt.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Jt=new E(3e4,6e4);function Xt(){const e=gt().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Yt(e){return new Promise((t,n)=>{function r(){Xt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Xt(),n(d(e,"network-request-failed"))},timeout:Jt.get()})}if(gt().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!gt().gapi?.load){const t=Ee("iframefcb");return gt()[t]=()=>{gapi.load?r():n(d(e,"network-request-failed"))},_e(`${we.gapiScript}?onload=${t}`).catch(e=>n(e))}r()}}).catch(e=>{throw Zt=null,e})}let Zt=null;const en=new E(5e3,15e3),tn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function rn(e){const t=e.config;g(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?I(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:r.MF},o=nn.get(e.config.apiHost);o&&(i.eid=o);const a=e._getFrameworks();return a.length&&(i.fw=a.join(",")),`${n}?${(0,s.Am)(i).slice(1)}`}const sn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class on{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const an=encodeURIComponent("fac");async function cn(e,t,n,i,o,a){g(e.config.authDomain,e,"auth-domain-config-required"),g(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:r.MF,eventId:o};if(t instanceof je){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,s.Im)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof qe){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];const h=await e._getAppCheckToken(),l=h?`#${an}=${encodeURIComponent(h)}`:"";return`${function({config:e}){return e.emulator?I(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,s.Am)(u).slice(1)}${l}`}const un="webStorageSupport",hn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dt,this._completeRedirectFn=$t,this._overrideRedirectResult=qt}async _openPopup(e,t,n,r){return v(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u={...sn,width:r.toString(),height:i.toString(),top:o,left:a},h=(0,s.ZQ)().toLowerCase();n&&(c=oe(h)?"_blank":n),se(h)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,s.ZQ)()){return le(e)&&!!window.navigator?.standalone}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new on(null);const d=window.open(t||"",c,l);g(d,e,"popup-blocked");try{d.focus()}catch(e){}return new on(d)}(e,await cn(e,t,n,w(),r),pt())}async _openRedirect(e,t,n,r){return await this._originValidation(e),s=await cn(e,t,n,w(),r),gt().location.href=s,new Promise(()=>{});var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(v(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Zt=Zt||Yt(e),Zt}(e),n=gt().gapi;return g(n,e,"internal-error"),t.open({where:document.body,url:rn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tn,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=d(e,"network-request-failed"),i=gt().setTimeout(()=>{r(s)},en.get());function o(){gt().clearTimeout(i),n(t)}t.ping(o).then(o,()=>{r(s)})}))}(e),n=new zt(e);return t.register("authEvent",t=>(g(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(un,{type:un},n=>{const r=n?.[0]?.[un];void 0!==r&&t(!!r),l(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return A(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Qt(e))return}catch{}l(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return de()||ie()||le()}};var ln="@firebase/auth",dn="1.11.1";class fn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const pn=(0,s.XA)("authIdTokenMaxAge")||300;let mn=null;const gn=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>pn)return;const s=n?.token;mn!==s&&(mn=s,await fetch(e,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function yn(e=(0,r.Sx)()){const t=(0,r.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,r.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,s.bD)(r,t??{}))return e;l(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:hn,persistence:[kt,ht,dt]}),i=(0,s.XA)("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=gn(e.toString());!function(e,t,n){(0,s.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e){(0,s.Ku)(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(n)}}const o=(0,s.Tj)("auth");return o&&function(e,t,n){const r=ye(e);g(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!n?.disableWarnings,o=Ae(t),{host:a,port:c}=function(e){const t=Ae(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:Ne(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ne(t)}}}(t),u=null===c?"":`:${c}`,h={url:`${o}//${a}${u}/`},l=Object.freeze({host:a,port:c,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return g(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void g((0,s.bD)(h,r.config.emulator)&&(0,s.bD)(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=h,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,(0,s.zJ)(a)?((0,s.gE)(`${o}//${a}${u}`),(0,s.P1)("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${o}`),n}var vn;we={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=d("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},vn="Browser",(0,r.om)(new o.uA("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;g(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:i,authDomain:o,clientPlatform:vn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fe(vn)},c=new ge(n,r,s,a);return function(e,t){const n=t?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Y);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,r.om)(new o.uA("auth-internal",e=>{return t=ye(e.getProvider("auth").getImmediate()),new fn(t);var t},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KO)(ln,dn,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(vn)),(0,r.KO)(ln,dn,"esm2020")},779:(e,t,n)=>{n.d(t,{j:()=>a,db:()=>c});var r=n(0);(0,r.KO)("firebase","12.6.0","app");var s=n(726),i=n(589);const o=(0,r.Wp)({apiKey:"AIzaSyADSVzI3zUWyJZCC1jvJZpKy6dxlxJSFsc",authDomain:"flashcard-exchange-340a4.firebaseapp.com",projectId:"flashcard-exchange-340a4",storageBucket:"flashcard-exchange-340a4.firebasestorage.app",messagingSenderId:"161145255164",appId:"1:161145255164:web:60566dab51c89358ab1379",measurementId:"G-QKWVJ7HXXD"}),a=(0,s.xI)(o),c=(0,i.aU)(o)},876:(e,t,n)=>{function r(){const e=document.getElementById("auth-section"),t=document.getElementById("app-section"),n=document.getElementById("deck-page"),r=document.getElementById("username-section");e&&(e.hidden=!1),t&&(t.hidden=!0),n&&(n.hidden=!0),r&&(r.hidden=!0)}function s(){const e=document.getElementById("user-decks");if(!e)return;if(document.getElementById("create-deck-btn"))return;const t=document.createElement("div");t.id="create-deck-btn",t.className="deck-card create-deck",t.innerHTML="\n    <span>+</span>\n    <p>Create New Deck</p>\n  ",t.onclick=()=>{document.dispatchEvent(new Event("create-deck"))},e.prepend(t)}function i(){const e=document.getElementById("auth-section"),t=document.getElementById("app-section"),n=document.getElementById("deck-page"),r=document.getElementById("username-section");e&&(e.hidden=!0),t&&(t.hidden=!1),n&&(n.hidden=!0),r&&(r.hidden=!0)}function o(){const e=document.getElementById("auth-section"),t=document.getElementById("app-section"),n=document.getElementById("deck-page"),r=document.getElementById("username-section");e&&(e.hidden=!0),t&&(t.hidden=!0),n&&(n.hidden=!1),r&&(r.hidden=!0),document.getElementById("back-to-dashboard").onclick=()=>{document.getElementById("deck-page").hidden=!0,document.getElementById("app-section").hidden=!1}}function a(){const e=document.getElementById("auth-section"),t=document.getElementById("app-section"),n=document.getElementById("deck-page"),r=document.getElementById("username-section");e&&(e.hidden=!0),t&&(t.hidden=!0),n&&(n.hidden=!0),r&&(r.hidden=!1)}function c(){const e=document.getElementById("username-section");e&&(e.hidden=!0)}function u(){const e=document.querySelector(".profile img"),t=document.querySelector(".profile-menu");e&&t&&(e.addEventListener("click",e=>{e.stopPropagation();const n="block"===t.style.display;t.style.display=n?"none":"block"}),document.addEventListener("click",n=>{t.contains(n.target)||n.target===e||(t.style.display="none")}))}n.d(t,{$H:()=>a,Q0:()=>o,UW:()=>r,VY:()=>u,Ws:()=>s,c2:()=>c,fe:()=>i})},887:(e,t,n)=>{n.d(t,{WB:()=>h,YX:()=>c,pL:()=>l});var r=n(779),s=n(589);let i=[],o=0,a=null;async function c(e,t=!1){a=e,window.currentDeckIsOwner=t,i=[];const n=(0,s.P)((0,s.rJ)(r.db,"decks",e,"cards"),(0,s.My)("createdAt","asc"));(await(0,s.GG)(n)).forEach(e=>{i.push({id:e.id,...e.data()})}),o=0,u()}function u(){const e=document.getElementById("study-card-front"),t=document.getElementById("study-card-back"),n=document.getElementById("study-counter"),u=document.getElementById("study-card-inner");if(!(e&&t&&n&&u))return;if(0===i.length)return e.innerText="No cards yet",t.innerText="Add cards to start studying",void(n.innerText="0 / 0");u.parentElement.classList.remove("flipped"),e.innerText=i[o].term,t.innerText=i[o].definition,n.innerText=`${o+1} / ${i.length}`;const h=document.getElementById("study-owner-actions");if(h&&(h.innerHTML="",window.currentDeckIsOwner)){const e=document.createElement("button");e.textContent="Edit",e.className="secondary",e.style.fontSize="1rem",e.style.padding="8px 16px",e.style.marginRight="10px",e.onclick=e=>{e.stopPropagation(),function(e){const t=document.getElementById("edit-card-modal"),n=document.getElementById("edit-card-term"),i=document.getElementById("edit-card-definition"),o=document.getElementById("save-card-changes"),u=document.getElementById("cancel-card-edit");n.value=e.term,i.value=e.definition,t.classList.remove("hidden"),o.onclick=async()=>{const o=n.value.trim(),u=i.value.trim();o&&u&&(await(0,s.mZ)((0,s.H9)(r.db,"decks",a,"cards",e.id),{term:o,definition:u}),t.classList.add("hidden"),c(a,window.currentDeckIsOwner))},u.onclick=()=>{t.classList.add("hidden")}}(i[o])};const t=document.createElement("button");t.textContent="Delete",t.className="danger",t.style.fontSize="1rem",t.style.padding="8px 16px",t.onclick=async e=>{e.stopPropagation(),confirm("Delete current card?")&&(await(0,s.kd)((0,s.H9)(r.db,"decks",a,"cards",i[o].id)),await c(a,window.currentDeckIsOwner))},h.appendChild(e),h.appendChild(t)}}function h(){const e=document.getElementById("study-flashcard"),t=document.getElementById("next-card-btn"),n=document.getElementById("prev-card-btn");e&&t&&n&&(e.onclick=()=>{e.classList.toggle("flipped")},t.onclick=()=>{o<i.length-1&&(o++,u())},n.onclick=()=>{o>0&&(o--,u())})}function l(e){a=e;const t=document.getElementById("add-card-modal"),n=document.getElementById("add-card-term"),i=document.getElementById("add-card-definition"),o=document.getElementById("add-card-confirm"),u=document.getElementById("add-card-cancel");n.value="",i.value="",t.classList.remove("hidden"),o.onclick=async()=>{const e=n.value.trim(),o=i.value.trim();if(e&&o)try{await(0,s.gS)((0,s.rJ)(r.db,"decks",a,"cards"),{term:e,definition:o,createdAt:(0,s.O5)()}),t.classList.add("hidden"),await c(a,window.currentDeckIsOwner)}catch(e){alert("Failed to add card"),console.error(e)}else alert("Both term and definition are required")},u.onclick=()=>{t.classList.add("hidden")}}}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=n(779),s=n(726),i=n(589),o=n(876);function a(e){const t=document.getElementById("display-username"),n=document.getElementById("welcome-username");t&&(t.innerText=e),n&&(n.innerText=e)}function c(e){const t=document.getElementById("auth-error");t&&(t.innerText=e)}function u(){const e=document.getElementById("auth-error");e&&(e.innerText="")}var h=n(70),l=n(887);function d(){console.log("Flashcard Exchange Web App Starting..."),function(){const e=document.getElementById("email"),t=document.getElementById("password"),n=document.getElementById("signup-btn"),h=document.getElementById("login-btn"),l=document.getElementById("logout-btn"),d=document.getElementById("delete-account-btn");n&&n.addEventListener("click",async()=>{u();try{const n=await(0,s.eJ)(r.j,e.value,t.value);(0,o.$H)(),function(e){const t=document.getElementById("username-form"),n=document.getElementById("username-input"),c=document.getElementById("username-error");t&&n&&(t.onsubmit=async t=>{t.preventDefault();const u=n.value.trim();u.length<3?c&&(c.innerText="Username must be at least 3 characters"):(await(0,i.BN)((0,i.H9)(r.db,"users",e.uid),{username:u,email:e.email,createdAt:(0,i.O5)()}),await(0,s.r7)(r.j.currentUser,{displayName:u}),a(u),(0,o.c2)(),(0,o.Ws)(),(0,o.fe)())})}(n.user)}catch(e){c(e.message)}}),h&&h.addEventListener("click",async()=>{u();try{await(0,s.x9)(r.j,e.value,t.value)}catch(e){c(e.message)}}),l&&l.addEventListener("click",()=>(0,s.CI)(r.j)),d&&d.addEventListener("click",async()=>{const e=r.j.currentUser;if(e&&confirm("This will permanently delete your account and all data. Continue?"))try{await(0,s.r7)(r.j.currentUser,{displayName:username}),await(0,i.kd)((0,i.H9)(r.db,"users",e.uid)),await(0,s.hG)(e),alert("Account deleted successfully")}catch(e){alert("Please login again to delete your account.")}}),(0,s.hg)(r.j,async e=>{if(!e)return void(0,o.UW)();const t=(0,i.H9)(r.db,"users",e.uid),n=await(0,i.getDoc)(t);if(n.exists()){const{username:e}=n.data();a(e),(0,o.c2)(),(0,o.Ws)(),(0,o.fe)()}})}(),(0,h.b)(),(0,l.WB)(),(0,o.VY)(),Promise.resolve().then(n.bind(n,70)).then(e=>{e.initHistoryDropdown&&e.initHistoryDropdown(),e.initSearchAddon&&e.initSearchAddon()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()})();